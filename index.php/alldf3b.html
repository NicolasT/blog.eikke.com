<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<!-- Mirrored from blog.eikke.com/index.php/all?blog=1&cat=49&page=1&paged=13 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:59:03 GMT -->
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>
	All Blogs - Categories: Coding Corner, Docbook, Summer of Code 06</title>
<base  />
<meta name="description" content="" />
<meta name="keywords" content="ikke eikke blog" />
<meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
<link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
<link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
<link rel="pingback" href="../xmlsrv/xmlrpc.php" />
<link rel="stylesheet" href="../skins/plain/style.css" type="text/css" />

</head>

<body>
<a name="top" id="top"></a>
<center>
		<div id="menu">
				<a href="all.html" title="The blog front page">home</a>
<a href="../htsrv/loginec9b.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%3Fblog%3D1%26amp%3Bcat%3D49%26amp%3Bpaged%3D13%26amp%3Bpage%3D1" title="Login if you have an account...">Login...</a>
<a href="all03a1.html?disp=comments">Last comments</a>
		</div>
		
		<div id="header">


      <h1><a href="all.html" style="border:0px;">All Blogs</a></h1>
      <h2></h2>
		</div>
		
		<div id="content">
		
				
				<div id="sidebar">
<div class="submenu">
<div class="boxTop">&nbsp;</div><div class="menuBox"><a href="all.html" class="menuItem" title="All Blogs">Blog All</a>
<a href="ikke.html" class="menuItem" title="Ikke&#039;s Blog">Ikke</a>
<a href="fedorastateless.html" class="menuItem" title="Fedora Stateless @ UGent">FSU</a>
<a href="realnitro.html" class="menuItem" title="RealNitro&#039;s Blog">RealNitro</a>
<a href="http://peterdedecker.net/blog/index.php" class="menuItem" title="Peter&#039;s Blog">Peter</a>
</div></div>

		<p></p>
<div class="postBox"><div class="boxTop">Categories</div><h4><a href="all.html">All Blogs</a></h4>
<h4><a href="ikke.html">Ikke's Blog</a></h4>
<ul><li><a href="allb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="all3f99.html?cat=16">Technology</a> <span class="notes">(131)</span><ul><li><a href="all3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span>*<ul><li><a href="allbff0.html?cat=52">Docbook</a> <span class="notes">(7)</span>*</li>
<li><a href="alle864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span>*</li>
</ul>
</li>
<li><a href="all8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span></li>
<li><a href="all7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span></li>
<li><a href="allc055.html?cat=17">Linux</a> <span class="notes">(90)</span></li>
<li><a href="all6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span></li>
</ul>
</li>
</ul>
<h4><a href="fedorastateless.html">Fedora Stateless @ UGent</a></h4>
<ul><li><a href="allede2.html?cat=32">General</a> <span class="notes">(10)</span></li>
<li><a href="allb97c.html?cat=30">Nifty solutions</a> <span class="notes">(3)</span></li>
<li><a href="allaeb3.html?cat=29">Problems we encounter</a> <span class="notes">(9)</span></li>
<li><a href="allb60a.html?cat=27">Project status and progress</a> <span class="notes">(13)</span></li>
</ul>
<h4><a href="realnitro.html">RealNitro's Blog</a></h4>
<ul><li><a href="alld11d.html?cat=54">Coding</a> <span class="notes">(9)</span></li>
<li><a href="allc733.html?cat=38">Fun</a> <span class="notes">(2)</span></li>
<li><a href="all97dc.html?cat=33">Gaming</a> <span class="notes">(4)</span><ul><li><a href="all9ad7.html?cat=35">CUBE</a> <span class="notes">(3)</span></li>
<li><a href="all9591.html?cat=37">Max Payne</a> <span class="notes">(0)</span></li>
<li><a href="alla88f.html?cat=36">RTCW:ET</a> <span class="notes">(2)</span></li>
</ul>
</li>
<li><a href="allf528.html?cat=47">Life</a> <span class="notes">(11)</span></li>
<li><a href="all8dbd.html?cat=50">Linux</a> <span class="notes">(7)</span></li>
<li><a href="all489b.html?cat=34">Webdesign</a> <span class="notes">(4)</span></li>
</ul>
<h4><a href="http://peterdedecker.net/blog/index.php">Peter's Blog</a></h4>
<ul><li><a href="all363a.html?cat=45">Free Software</a> <span class="notes">(9)</span><ul><li><a href="allb0b4.html?cat=48">Jabber</a> <span class="notes">(4)</span></li>
<li><a href="all51fa.html?cat=40">Linux</a> <span class="notes">(9)</span><ul><li><a href="allffca.html?cat=41">My Gentoo</a> <span class="notes">(19)</span></li>
<li><a href="allf170.html?cat=53">Ubuntu@AMD64</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="all434a.html?cat=57">Workgroup Free Software</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="alle7dd.html?cat=59">Internet &amp; Blogs</a> <span class="notes">(12)</span></li>
<li><a href="alle8fb.html?cat=39">Life &amp; Fun</a> <span class="notes">(47)</span></li>
<li><a href="all1e3b.html?cat=55">Politics</a> <span class="notes">(16)</span><ul><li><a href="allfa15.html?cat=51">EU Software Patents</a> <span class="notes">(8)</span></li>
<li><a href="all848d.html?cat=58">N-VA</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="all667c.html?cat=43">Studies</a> <span class="notes">(23)</span><ul><li><a href="all493d.html?cat=62">Siemens</a> <span class="notes">(13)</span></li>
</ul>
</li>
<li><a href="alle868.html?cat=60">UGent &amp; Stuver</a> <span class="notes">(18)</span></li>
<li><a href="allac94.html?cat=42">VTK</a> <span class="notes">(10)</span></li>
</ul>

</div>
<div class="boxTop"><a href="all03a1.html?disp=comments">Last comments</a></div>
<div class="postBox">	

  <ul>
<li>- louboutin on <a href="ikke/2005/12/23/crosswords.html#c11861" title="permalink to comment">Crosswords</a>

</li>
<li>- rhinestone motif on <a href="ikke/2005/11/19/ooo2_on_770.html#c11860" title="permalink to comment">OOo2 on 770</a>

</li>
<li>- richard on <a href="ikke/2007/05/08/openoffice_rant.html#c11859" title="permalink to comment">OpenOffice rant</a>

</li>
<li>- Tom on <a href="ikke/2005/01/31/gob_signals_walkthrough.html#c11858" title="permalink to comment">GOB signals walkthrough</a>

</li>
<li>- Tom on <a href="ikke/2005/01/31/gob_signals_walkthrough.html#c11857" title="permalink to comment">GOB signals walkthrough</a>

</li>
        </ul>
</div>

<div class="postBox"><table class="bCalendarTable" cellspacing="0" summary="Monthly calendar with links to each day's posts">
<caption class="bCalendarCaption"><a href="all/2012/12/index.html" title="go to month's archive">December 2012</a></caption>
<thead><tr class="bCalendarRow">
<th class="bCalendarHeaderCell" abbr="Sunday" scope="col" title="Sunday">Sun</th>
<th class="bCalendarHeaderCell" abbr="Monday" scope="col" title="Monday">Mon</th>
<th class="bCalendarHeaderCell" abbr="Tuesday" scope="col" title="Tuesday">Tue</th>
<th class="bCalendarHeaderCell" abbr="Wednesday" scope="col" title="Wednesday">Wed</th>
<th class="bCalendarHeaderCell" abbr="Thursday" scope="col" title="Thursday">Thu</th>
<th class="bCalendarHeaderCell" abbr="Friday" scope="col" title="Friday">Fri</th>
<th class="bCalendarHeaderCell" abbr="Saturday" scope="col" title="Saturday">Sat</th>
</tr></thead>
<tfoot>
<tr>
<td colspan="3" id="prev"><a href="all/2007/12/index.html" title="Previous year (2007-12)">&lt;&lt;</a>&nbsp;<a href="all/2007/12/index.html" title="Previous month (2007-12)">&lt;</a></td>
<td class="pad">&nbsp;</td>
<td colspan="3" id="next">&nbsp;&nbsp;</td>
</tr>
</tfoot>
<tr class="bCalendarRow">
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarCell">1</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">2</td>
<td class="bCalendarCell">3</td>
<td class="bCalendarCell">4</td>
<td class="bCalendarCell">5</td>
<td class="bCalendarCell">6</td>
<td class="bCalendarCell">7</td>
<td class="bCalendarCell">8</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">9</td>
<td class="bCalendarCell">10</td>
<td id="bCalendarToday">11</td>
<td class="bCalendarCell">12</td>
<td class="bCalendarCell">13</td>
<td class="bCalendarCell">14</td>
<td class="bCalendarCell">15</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">16</td>
<td class="bCalendarCell">17</td>
<td class="bCalendarCell">18</td>
<td class="bCalendarCell">19</td>
<td class="bCalendarCell">20</td>
<td class="bCalendarCell">21</td>
<td class="bCalendarCell">22</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">23</td>
<td class="bCalendarCell">24</td>
<td class="bCalendarCell">25</td>
<td class="bCalendarCell">26</td>
<td class="bCalendarCell">27</td>
<td class="bCalendarCell">28</td>
<td class="bCalendarCell">29</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">30</td>
<td class="bCalendarCell">31</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
</tr>
</table></div>
<div class="postBox"><div class="boxTop">Archives</div><ul><li><a href="all/2007/12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="all/2007/10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="all/2007/08/index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="all/2007/05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="all/2007/03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="all/2007/02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="all/2006/10/index.html">October 2006</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2006/08/index.html">August 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="all1579.html?disp=arcdir">More...</a></li>
</ul>
</div>

<!-- =============== SEARCH BOX ======================== --> 
<div class="boxTop">Search</div>
<div class="postBox"><form action="http://blog.eikke.com/index.php/all" method="get" id="searchform">	<br />	<div align="center"><input class="search" size="15" name="s" /><br />
        <input type="submit" value="Search" name="submit" class="btn"  />
        </div>
</form>
</div>
<div class="postBox">
<h3 class="boxTop">Who's Online?</h3>
	<ul class="onlineUsers"><li>Guest Users: 430</li></ul>	</div>

			
<div class="boxTop">Syndicate this blog <img src="../img/xml.html" alt="XML" width="36" height="14" class="middle" /></div>               
	<div class="postBox">
RSS 0.92: <a href="http://eikke.com/feed/">Posts</a>, <a href="all7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
<br />
RSS 1.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="all374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
<br />
RSS 2.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="all6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
<br />
Atom: <a href="http://eikke.com/feed/">Posts</a>, <a href="all5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
</div>		

<!-- Menu footer -->
<br /> <div align="center">powered by<br />
<a href="http://b2evolution.net/" title="b2evolution home"><img src="../img/b2evolution_logo_80.html" alt="b2evolution" width="80" height="17" border="0" class="middle" /></a></div>
				</div>
						
						
				<div id="mainbar">

<h2>Categories: Coding Corner, Docbook, Summer of Code 06</h2><!-- 
== START OF MAIN AREA
====== -->

<h2>02/04/05</h2><div class="bPost" lang="en-US">
		<div class="title"><a href="http://www.eikke.com/articles">Articles</a></div>
	<div class="bText">
		<p>Converted my <a href="ikke/2005/01/31/gob_signals_walkthrough.html" title="first article">first article</a>, the one about <a href="http://developer.gnome.org/doc/API/2.0/gobject/gobject-Signals.html" title="GObject Signals">GObject Signals</a>, into the <a href="http://www.docbook.org/" title="Docbook">Docbook</a> format.<br />
The resulting HTML is <a href="http://www.eikke.com/articles/gob-signals.html" title="here">here</a>, the Docbook XML source <a href="http://www.eikke.com/articles/gob-signals.dbk" title="here">here</a>.<br />
The CSS stylesheet needs some more polishing, I know.<br />
Also try viewing the article in Yelp: download the source, and run "yelp gob-signals.dbk".<br />
I updated my <a href="http://www.eikke.com/" title="homepage">homepage</a> so there's a new link to the <a href="http://www.eikke.com/articles/" title="articles">articles</a> section now.</p>

<p>I'll convert the <a href="ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi.html" title="article on Makefiles">article on Makefiles</a> later, it's a tedious job.</p>

<p>Started working on the "Glib Mainloop" one, won't be finished too soon (not easy to know what to write about ;-))</p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/02/04/articles.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  10:52:53 pm	  .

          168 Words          .
	  
	<a href="ikkeb5e7.html?cat=15" title="true">Life</a>, <a href="ikke3f99.html?cat=16" title="true">Technology</a>, <a href="ikkec055.html?cat=17" title="true">Linux</a>, <a href="ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	229 views	
	 . <a href="ikke/2005/02/04/articles.html#comments" title="Display comments / Leave a comment">Leave a comment</a>	  	</div>
	</div>
<h2>02/01/05</h2><div class="bPost" lang="en-US">
		<div class="title">Writing Makefiles the manual way, and using autotools</div>
	<div class="bText">
		<p>As promised, the article on writing Makefiles. As an extra, I also include how to build a basic/simple <a href="http://sources.redhat.com/autobook/autobook/autobook_toc.html" title="autotools">autotools</a> project.</p>

<h2>Writing Makefiles, the manual way</h2>
<p>Let's get started.<br />
First of all, you need all files used in my <a href="ikke/2005/01/31/gob_signals_walkthrough.html" title="previous article">previous article</a>, i.e. test-signal.gob and test-signal-test.c</p>

<p>There are some rules of thumb you can use when writing a Makefile manally:</p>
<ol>
<li>Find out what programs you need to process your source files</li><br />
<li>Find out what packages you need: which headers, and which libraries</li><br />
<li>Make a list of all source files, and find out which ones are dependent on others</li>
</ol>

<p>Let's get through these step by step:</p>
<ol>
<li>What programs do we need? We need <a href="http://www.5z.com/jirka/gob.html" title="gob2">gob2</a> of course, to process our gob file. Next to this, we need the stuff you need most of the time when creating a Makefile: a compiler and a linker. And guess what, <a href="http://gcc.gnu.org/" title="GCC">GCC</a> can do both things.</li><br />
<li>What packages do we need? Remember the command line thing you had to use when compiling the test-signal executable?<blockquote><p>gcc -Wall `pkg-config --libs --cflags gobject-2.0 glib-2.0` -o testsignal test-signal-test.c test-signal.c</p></blockquote>We don't even need this line to figure out what we need: we're building a <a href="http://developer.gnome.org/doc/API/2.0/gobject/" title="gobject">gobject</a>, so we need all libs and headers provided by the gobject package, version 2.x in our case, same thing for <a href="http://developer.gnome.org/doc/API/2.0/glib/" title="glib">glib</a>.<br />
How can we find out where these things are located? Well, the smart people at <a href="http://www.freedesktop.org/" title="freedesktop.org">freedesktop.org</a> made a nifty tool called <a href="http://www.freedesktop.org/Software/pkgconfig" title="pkg-config">pkg-config</a>. When a library is installed, it can install a pkg-config resource file, which lists the directories where it's stuff is installed. For some samples of these files, check /usr/lib/pkg-config. The pkg-config command line utility can parse these files and give you the information you need.</li><br />
<li>What source files have we got, and which one needs which? We got 2 files, test-signal.gob and test-signal-test.c. In the end we want to generate an executable called test-signal, which needs test-signal.c (the GObject implementation file) and test-signal-test.c.<br />
We will work in 2 stages here: first we'll compile all necessary .c files to an object file (.o), then in the end link all object files together in a nice executable.<br />
Here's what should happen: test-signal.gob should be parsed by gob to create our test-signal.c and test-signal.h file, test-signal.c must be compiled, test-signal-test.c must be compiled, and finaly test-signal.o and test-signal-test.o should be linked into test-signal.</li>
</ol>
<p>First a little intermezzo. You might be asking "If I need to make all these lists, what's the use? Can't I just write some <a href="http://www.gnu.org/software/bash/bash.html" title="Bash">Bash</a> script which executes the gcc command all at once?". Well, no. <a href="http://www.gnu.org/software/make/" title="Make">Make</a> does more than just executing some commands. It also checks whether it *should* do something. Imagine you got 100 source files. You got all of them compiled, linked into some executable, run that one, and find some bug. You fix it by editing some lines in one file, and re-execute your huge gcc command. Gcc would recompile all 100 files, which will take some time.<br />
If you use a Makefile make will find out only one file has been altered since the last build, it'll let gcc recompile only that file, then relink all object files together, which will take less time. Next to this: once using autotools, everything becomes much simpeler ;-)</p>

<p>Ok, now we got all prerequisites. Let's get started writing our Makefile.<br />
I always tend to use the same format when writing one (although I dont write many of them, I use autotools ;-)). I start with defining the executables:</p>
<blockquote><pre>GOB2=gob2
CC=gcc
LD=gcc</pre></blockquote><p>This is not necessary, but can be usefull sometimes. Now we can use these variables later on. If we want to change the linker, we only have to edit the Makefile in one place.</p>

<p>Next comes the definition of the CFLAGS, the flags given to the compiler (CC) when compiling a sourcefile into an object file:</p>
<blockquote><pre>CFLAGS=`pkg-config --cflags glib-2.0`
CFLAGS+=`pkg-config --cflags gobject-2.0`
CFLAGS+=-Wall -g</pre></blockquote>
<p>As you can see, we request the CFLAGS necessary for glib-2.0 and gobject-2.0 (2.x, actually) by querying pkg-config. In the end we add 2 compiler flags: -Wall, which tells gcc to show all possible warnings, and -g, which tells gcc to include debugging information. This can result in a somewhat bigger executable, but it is very usefull if we want to debug the program using <a href="http://www.gnu.org/software/gdb/" title="GDB">GDB</a>.</p>

<p>Now we define the LDFLAGS, the flags given to the linker:</p>
<blockquote><pre>LDFLAGS=`pkg-config --libs glib-2.0`
LDFLAGS+=`pkg-config --libs gobject-2.0`</pre></blockquote><p>This should be fairly self-explaining.</p>

<p>This project only consists of one executable, so I define an "OBJS" variable including all the object files needed to build our executable:</p>
<blockquote><pre>OBJS=test-signal.o test-signal-test.o</pre></blockquote>

<p>Now comes the name of the executable we want to create:</p>
<blockquote><pre>PROG=test-signal</pre></blockquote>

<p>Now the magic starts. Until now we only defined some variables for later use. We were not forced to do so, it's just more convenient later on. Actually, when building small things, we can just use re-use this Makefile, and only have to change the variable definitions (OBJS, PROG, maybe some CFLAGS and LDFLAGS).</p>

<p>Now some rules follow, which tell make how to handle files:</p>
<blockquote><pre>%.c %.h %-private.h: %.gob
        $(GOB2) $&lt;</pre></blockquote>
<p>This rule tells make: "When a foo.c, foo.h or foo-private.h is needed, and not existant, it should be made from foo.gob, by executing "$(GOB2) $&lt;" which gets expanded as "gob2 foo.gob"". Indeed, % represent "a string", $(GOB2) is the variable we defined at the beginning and gets expanded as "gob2", and $&lt; gets expanded as the first item on the right of the semicolon (":").<br />
One big thing to watch out for: Makefiles are indenting-sensitive <b>but</b> you may <b>not</b> use spaces. So in the last Makefile fragment there's a [tab] before $(GOB2).<br />
The format of a rule is very simple:</p>
<blockquote><pre>filenametobuild: dependenciestobuilditfrom
[tab]what to do first[enter]
[tab]what to do next if necessary[enter]</pre></blockquote><p>etc.</p>

<p>Next we define how to link our $(PROG):</p>
<blockquote><pre>$(PROG): $(OBJS)
        $(CC) $(LDFLAGS) $(OBJS) -o $(PROG)</pre></blockquote><p>$(PROG) is built out of $(OBJS) by issuing "$(CC) $(LDFLAGS) $(OBJS) -o $(PROG)", expanded to "gcc `pkg-config --libs gobject-2.0` `pkg-config --libs glib-2.0` test-signal.o test-signal-test.o -o test-signal"</p>

<p>We still have to tell make how to create object files out of source files:</p>
<blockquote><pre>%.o: %.c
        $(CC) $(CFLAGS) -c $&lt;</pre></blockquote>
<p>You should be able to figure out what this does by yourself.</p>

<p>Now we add some convenience targets:</p>
<blockquote><pre>all: $(PROG)

default: $(PROG)

clean:
        rm -f $(OBJS) $(PROG)
        rm -f test-signal.[ch]
        rm -f test-signal-private.h</pre></blockquote><p>This enables us to just type "make", which will start building the "default" target, or "make all", which will build the "all" target, or "make clean" to "build" the "clean" target.<br />
Notice a target </p><ol><li>is not forced to "do" something ("all" and "default"). You can just say "it depends on "foo" and/or "bar", which will be built then, and</li><br />
<li>the dependencies of a target <em>may</em> be empty ("clean")</li></ol>

<p>Let's end with the complete Makefile:</p>
<blockquote><pre>GOB2=gob2
CC=gcc
LD=gcc

CFLAGS=`pkg-config --cflags glib-2.0`
CFLAGS+=`pkg-config --cflags gobject-2.0`
CFLAGS+=-Wall -g

LDFLAGS=`pkg-config --libs glib-2.0`
LDFLAGS+=`pkg-config --libs gobject-2.0`

OBJS=test-signal.o test-signal-test.o

PROG=test-signal

%.c %.h %-private.h: %.gob
        $(GOB2) $&lt;

$(PROG): $(OBJS)
        $(CC) $(LDFLAGS) $(OBJS) -o $(PROG)

%.o: %.c
        $(CC) $(CFLAGS) -c $&lt;

all: $(PROG)

default: $(PROG)

clean:
        rm -f $(OBJS) $(PROG)
        rm -f test-signal.[ch]
        rm -f test-signal-private.h
</pre></blockquote>
<p>Save this file as a file called "Makefile" in your source directory, and type "make". This should be the result:</p>
<blockquote><p>gob2 test-signal.gob<br />
gcc `pkg-config --cflags glib-2.0` `pkg-config --cflags gobject-2.0` -Wall -g -c test-signal.c<br />
test-signal.c: In function `test_signal_testsignal':<br />
test-signal.c:141: warning: implicit declaration of function `memset'<br />
gcc `pkg-config --cflags glib-2.0` `pkg-config --cflags gobject-2.0` -Wall -g -c test-signal-test.c<br />
gcc `pkg-config --libs glib-2.0` `pkg-config --libs gobject-2.0` test-signal.o test-signal-test.o -o test-signal<br />
rm test-signal.c</p>
</blockquote><p>Notice the "rm test-signal.c": make removes the files it generated itself, so when you update test-signal.gob, it will tell gob to reconstruct the c file, otherwise the c file wouldnt get updated.</p>

<p>Now you should be able to execute ./test-signal.</p>

<p>Ok, we got a nice Makefile now, but it took some time to write it, isn't it? And we don't have a "normal" FOSS install method like ./configure, make, make install...</p>

<p>Well, that's what we are going to do now. The following stuff is much easier than writing Makefiles by hand (you know, FOSS devs <em>are</em> lazy people ;-)), but it is useful to know how Makefiles are formatted, and how they work, though.</p>

<p>Ok, time for some really 1337 (couldn't stop it) stuff: introducing <a href="http://www.gnu.org/" title="GNU">GNU</a> Autotools.</p>

<h2>Using the GNU Autotools to build your project</h2>
<p>Didn't you ever want to be able to write such a neat ./configure script yourself? Here's how to do it with our sample project :-)</p>

<p>Autotools consist of a bunch of utilities, most of them starting with "auto" (duh). There's <a href="http://www.gnu.org/software/autoconf/" title="autoconf">autoconf</a> to generate a "configure" script from a file you provide, there's the <a href="http://www.gnu.org/software/automake/" title="automake">automake</a> script that creates Makefile's for you (actually, it does not create Makefiles. Read on), and many more.</p>

<p>This is how it works: the configure script will look up a bunch of stuff for you (or you provide it using --with-foo=... etc), it will do some tests to figure out whether the project should compile and run cleanly on your system, and in the end it will generate some files.<br />
A boilerplate for these generated files should be provided by you, called "thefile.in". The generated file will be "thefile" then. Inside "thefile.in", you can use variables like these: "@FOO@", which will be substituted by the configure script.<br />
That's the system automake uses: you write a simple Makefile.am file (read on on how to do this), automake generates a long and difficult Makefile.in file, which gets processed by configure to create the final Makefile.</p>

<p>GNU Autotools have some strict rules (although it is possible, but not advisable, to get around them). Source files should be in the src/ subdirectory, and some files are required in the root directory of the project. We'll find out which ones these are later on.</p>

<p>Let's get started by creating our initial project directory layout:</p>
<blockquote><p>#Go into an empty directory<br />
mkdir src<br />
cd src<br />
cp /foo/bar/test-signal.gob ./<br />
cp /foo/bar/test-signal-test.c ./<br />
cd ..</p></blockquote>

<p>Initial task: once more, figure out what the required dependencies are. As mentioned in the first part, we need gobject-2.0 and glib-2.0. Next to this, we need a working C compiler.</p>

<p>We can start writing a configure.in file now, in the root dir of our project, which will be processed by autoconf to generate out ./configure script. Here's what it could look like, comments (starting with "dnl") inline:</p>
<blockquote><pre>dnl Register ourselves to autoconf, giving the main source file
AC_INIT(src/test-signal-test.c)

dnl Init Automake, giving the program name and version. More parameters (author and author's email) are optional
AM_INIT_AUTOMAKE(TestSignal, 0.1)
dnl Enable maintainer mode (debugging flags etc)
AM_MAINTAINER_MODE

dnl Check whether we got a good C compiler. Variable "CC" will be defined and expanded in the .in files
AC_PROG_CC

dnl GOB2 macro, to check whether gob version >=x.y.z (here >=2.0.0) is found. Variable "GOB2" will be substituted/expanded
GOB2_CHECK([2.0.0])

dnl Use built-in macro's to query pkg-config. First parameter is a variable name we'll use later on, second is the package to check for (with optional minimal version), third is the thing to do if the package is found, fourth if not
PKG_CHECK_MODULES(GLIB, glib-2.0, have_glib=true, have_glib=false)
if test "x${have_glib}" = "xfalse" ; then
        AC_MSG_ERROR([No Glib package information found])
fi
dnl So glib-2.0 is found. Remember the first parameter in the previous command, GLIB? Well, GLIB_CFLAGS now contains the output of `pkg-config --cflags glib-2.0`, same thing for GLIB_LIBS with --libs instead of --cflags
dnl AC_SUBST tells configure to substitute the given value in the provided .in files
AC_SUBST(GLIB_CFLAGS)
AC_SUBST(GLIB_LIBS)

dnl Same thing for gobject-2.0
PKG_CHECK_MODULES(GOBJECT, gobject-2.0, have_gobject=true, have_gobject=false)
if test "x${have_gobject}" = "xfalse" ; then
        AC_MSG_ERROR([No GObject package information found])
fi
AC_SUBST(GOBJECT_CFLAGS)
AC_SUBST(GOBJECT_LIBS)

dnl Here we tell the configure script which files to *create*, so we leave out the .in part
AC_OUTPUT([
        Makefile        \
        src/Makefile
])
</pre></blockquote><p>Currently Makefile.in and src/Makefile.in don't exist yet, they will be created by automake later on.</p>

<p>This file is a very simple one, it can be a tedious job to create <a href="http://cvs.sourceforge.net/viewcvs.py/ivman/ivman/configure.in?rev=1.12&amp;view=auto" title="complex configure.in files">complex configure.in files</a> :-/</p>

<p>Next thing: Makefile.am files, which will be processed by automake to create the Makefile.in's.<br />
In the project root dir, this file can be very simple:</p><blockquote><pre>SUBDIRS = src</pre></blockquote><p>We just define the subdir(s) of the current dir.<br />
src/Makefile.am is a little more complex:</p>
<blockquote><pre>INCLUDES = $(GLIB_CFLAGS) $(GOBJECT_CFLAGS)

bin_PROGRAMS = test-signal

test_signal_SOURCES = test-signal.c test-signal-test.c

test_signal_LDADD = $(GLIB_LIBS) $(GOBJECT_LIBS)

%.c %.h %-private.h: %.gob
        @GOB2@ $&lt;</pre></blockquote><p>Some explanation:</p>
<ul><li>"INCLUDES" is a variable that will be given to every compile call to "$(CC)", here we only need the glib and gobject includes. Remember these values will be setted by the configure script.</li>
<li>"bin_PROGRAMS" is a variable defining the names of all targets we want to be installed as an executable in the bin directory (/usr/local/bin if no prefix is given to ./configure)</li>
<li>"test_signal_SOURCES" is a variable defining which files are needed to make the target "test-signal". Notice "-" being replaced with "_" here, which is a common thing in automake files.</li>
<li>"test_signal_LDADD" defines which parameters to offer to the linker when linking the input object files to the "test-signal" executable. We could have used a global "LDADD" variable here, like "INCLUDES", or have made "INCLUDES" non-global by using "test_signal_INCLUDES". In large projects this can make a big difference.</li>
<li>The last part is the one we also used in our hand-written Makefile. It will be put like this in the resulting Makefile.in by automake, so make will know how to build .c and .h files from a .gob file.<br />
Automake puts all non-automake-specific stuff that's in Makefile.am in the resulting Makefile.in.</li></ul>

<p>Now everything is done. At least, almost ;-) We still need to call out autotool scripts.<br />
It's easy to do this from a shell script. Most projects call this script "autogen.sh", so will we. This script can be <a href="http://cvs.sourceforge.net/viewcvs.py/ivman/ivman/autogen.sh?view=markup" title="fairly complex">fairly complex</a>, ours will be braindead easy:</p>
<blockquote><pre>#!/bin/bash
aclocal
autoconf
automake -a
</pre></blockquote><p>As you can see, we first call aclocal (part of the automake package), then autoconf, then automake with the -a flag.<br />
Why "aclocal"? Autoconf, which creates a configure script out of a configure.in file, uses M4, a complex macro system, to do this. aclocal copies the necessary macro definitions for your system to the right place.</p>

<p>Run this script, or enter the commands by hand. aclocal can give a lot of warnings, don't bother about these.<br />
If this is the first time you run the script, you will see some automake errors in the end, and the script execution will fail:</p>
<blockquote><p>Makefile.am: required file `./NEWS' not found<br />
Makefile.am: required file `./README' not found<br />
Makefile.am: required file `./AUTHORS' not found<br />
Makefile.am: required file `./ChangeLog' not found</p>
</blockquote><p>These are the required files I mentioned earlier. We'll just touch them for now so they "exist", although contain no usefull information:</p>
<blockquote><p>touch NEWS README AUTHORS ChangeLog</p></blockquote>
<p>Now restart the autogen.sh script, everything should pass now.</p>

<p>If you take a look now, you'll see a couple of Makefile.in files are created now (who will be converted into Makefiles by configure, remember?), and the configure script.</p>

<p>Let's take our work to the test, and run ./configure. You'll see the usual output, and everything should pass fine (we don't have a lot of prerequisites :-))</p>

<p>Now let's try if our project builds fine:</p>
<blockquote><p>make</p></blockquote>

<p>Jay, lot of compiler commands, no errors. Fun :-)</p>

<p>To finish, test whether the executable works:</p>
<blockquote><pre>cd src
./test-signal</pre></blockquote><p>The same output as before appears, we're member of the Autotools User Group now ;-)</p>

<p>That's it for now, more stuff should follow: "The Glib mainloop", "Debugging using GDB", and a from-scratch "program" we'll create. I only lack the time to write everything ;-)</p>

<p>I'd like to convert these articles to some format so they can be used outside this blog (converted to PDF, HTML,...). <a href="http://www.docbook.org/" title="Docbook">Docbook</a> seems to be a good format to do this, I need to get used to it first, though. If someone knows a good Docbook editor (next to <a href="http://www.conglomerate.org/" title="Conglomerate">Conglomerate</a>), please let me know.</p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  10:49:08 pm	  .

          2936 Words          .
	  
	<a href="ikke3f99.html?cat=16" title="true">Technology</a>, <a href="ikkec055.html?cat=17" title="true">Linux</a>, <a href="ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	2952 views	
	 . <a href="ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi.html#comments" title="Display comments / Leave a comment">1 comment</a>	  	</div>
	</div>
<div class="bPost" lang="en-US">
		<div class="title">New category</div>
	<div class="bText">
		<p>Just made a new blogging category, "Coding Corner". I've got some ideas related to a serie of articles on Gnome/Glib coding, building on GObjects like in the article of yesterday, but also introducing some basic GTK+ coding, daemonizing, autotools (autoconf/automake/autoheader) and some more. It will be a little "Hello world" program, which can *normally* be done in like 10 lines of code, but a little more sophisticated here. I hope I'll be able to start writing the first article (about the Glib mainloop) tomorrow afternoon.<br />
I'm looking for some format to write the articles in, so maybe I'll be able to generate PDF documents of them later on, etc. Maybe I should take a look at Docbook? LaTeX isn't really suited here.<br />
Of course the CUPS PDF Writer could do it's job too ;-)</p>

<p>Got an exam at 14:00 and tomorrow morning, wish me luck, I need it.</p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/02/01/new_category.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  09:37:36 am	  .

          148 Words          .
	  
	<a href="ikkeb5e7.html?cat=15" title="true">Life</a>, <a href="ikke3f99.html?cat=16" title="true">Technology</a>, <a href="ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	207 views	
	 . <a href="ikke/2005/02/01/new_category.html#comments" title="Display comments / Leave a comment">1 comment</a>	  	</div>
	</div>
<h2>01/31/05</h2><div class="bPost" lang="en-US">
		<div class="title">GOB signals walkthrough</div>
	<div class="bText">
		<p>I mentioned the "<a href="http://www.5z.com/jirka/gob.html" title="GOB">GOB</a>" utility a couple of times already, but the more I use it, the more I start to love it.</p>

<p>I'd like to take you on a little "<a href="http://developer.gnome.org/doc/API/2.0/glib/" title="Glib">Glib</a>/<a href="http://developer.gnome.org/doc/API/2.0/gobject/" title="GObject">GObject</a> <a href="http://developer.gnome.org/doc/API/2.0/gobject/gobject-Signals.html" title="Signals">Signals</a>" tour today.</p>

<p>First of all, what are Signals? The <a href="http://developer.gnome.org/doc/API/2.0/gobject/gobject-Signals.html" title="GObject Signal API">GObject Signal API</a> states:</p>
<blockquote><p>Signals </p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/01/31/gob_signals_walkthrough.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  02:04:57 pm	  .

          830 Words          .
	  
	<a href="ikke3f99.html?cat=16" title="true">Technology</a>, <a href="ikkec055.html?cat=17" title="true">Linux</a>, <a href="ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	7549 views	
	 . <a href="ikke/2005/01/31/gob_signals_walkthrough.html#comments" title="Display comments / Leave a comment">46 comments</a>	  	</div>
	</div>

<p class="center"><strong>
	<a href="all1fb3.html?blog=1&amp;cat=49&amp;page=1&amp;paged=12">&lt;&lt; Previous Page</a> :: 	</strong></p>

	
							
						
		  </div>
		
  </div>
  <br clear="all" />
  <div id="footer">
  <!-- This is the footer. Put all your copyright info here. -->
  <br />
  Design by <a href="http://www.jameskoster.co.uk/">James Koster</a>, Evoskin by <a href="http://www.brendoman.com/dbc">Danny Ferguson</a></div>
</center>
</body>

<!-- Mirrored from blog.eikke.com/index.php/all?blog=1&cat=49&page=1&paged=13 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:59:04 GMT -->
</html>
