<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<!-- Mirrored from blog.eikke.com/index.php/all?blog=1&page=1&paged=56 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 20:06:23 GMT -->
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>
	All Blogs</title>
<base  />
<meta name="description" content="" />
<meta name="keywords" content="ikke eikke blog" />
<meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
<link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
<link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
<link rel="pingback" href="../xmlsrv/xmlrpc.php" />
<link rel="stylesheet" href="../skins/plain/style.css" type="text/css" />

</head>

<body>
<a name="top" id="top"></a>
<center>
		<div id="menu">
				<a href="all.html" title="The blog front page">home</a>
<a href="../htsrv/logincde4.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%3Fblog%3D1%26amp%3Bpaged%3D56%26amp%3Bpage%3D1" title="Login if you have an account...">Login...</a>
<a href="all03a1.html?disp=comments">Last comments</a>
		</div>
		
		<div id="header">


      <h1><a href="all.html" style="border:0px;">All Blogs</a></h1>
      <h2></h2>
		</div>
		
		<div id="content">
		
				
				<div id="sidebar">
<div class="submenu">
<div class="boxTop">&nbsp;</div><div class="menuBox"><a href="all.html" class="menuItem" title="All Blogs">Blog All</a>
<a href="ikke.html" class="menuItem" title="Ikke&#039;s Blog">Ikke</a>
<a href="fedorastateless.html" class="menuItem" title="Fedora Stateless @ UGent">FSU</a>
<a href="realnitro.html" class="menuItem" title="RealNitro&#039;s Blog">RealNitro</a>
<a href="http://peterdedecker.net/blog/index.php" class="menuItem" title="Peter&#039;s Blog">Peter</a>
</div></div>

		<p></p>
<div class="postBox"><div class="boxTop">Categories</div><h4><a href="all.html">All Blogs</a></h4>
<h4><a href="ikke.html">Ikke's Blog</a></h4>
<ul><li><a href="allb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="all3f99.html?cat=16">Technology</a> <span class="notes">(131)</span><ul><li><a href="all3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span><ul><li><a href="allbff0.html?cat=52">Docbook</a> <span class="notes">(7)</span></li>
<li><a href="alle864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span></li>
</ul>
</li>
<li><a href="all8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span></li>
<li><a href="all7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span></li>
<li><a href="allc055.html?cat=17">Linux</a> <span class="notes">(90)</span></li>
<li><a href="all6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span></li>
</ul>
</li>
</ul>
<h4><a href="fedorastateless.html">Fedora Stateless @ UGent</a></h4>
<ul><li><a href="allede2.html?cat=32">General</a> <span class="notes">(10)</span></li>
<li><a href="allb97c.html?cat=30">Nifty solutions</a> <span class="notes">(3)</span></li>
<li><a href="allaeb3.html?cat=29">Problems we encounter</a> <span class="notes">(9)</span></li>
<li><a href="allb60a.html?cat=27">Project status and progress</a> <span class="notes">(13)</span></li>
</ul>
<h4><a href="realnitro.html">RealNitro's Blog</a></h4>
<ul><li><a href="alld11d.html?cat=54">Coding</a> <span class="notes">(9)</span></li>
<li><a href="allc733.html?cat=38">Fun</a> <span class="notes">(2)</span></li>
<li><a href="all97dc.html?cat=33">Gaming</a> <span class="notes">(4)</span><ul><li><a href="all9ad7.html?cat=35">CUBE</a> <span class="notes">(3)</span></li>
<li><a href="all9591.html?cat=37">Max Payne</a> <span class="notes">(0)</span></li>
<li><a href="alla88f.html?cat=36">RTCW:ET</a> <span class="notes">(2)</span></li>
</ul>
</li>
<li><a href="allf528.html?cat=47">Life</a> <span class="notes">(11)</span></li>
<li><a href="all8dbd.html?cat=50">Linux</a> <span class="notes">(7)</span></li>
<li><a href="all489b.html?cat=34">Webdesign</a> <span class="notes">(4)</span></li>
</ul>
<h4><a href="http://peterdedecker.net/blog/index.php">Peter's Blog</a></h4>
<ul><li><a href="all363a.html?cat=45">Free Software</a> <span class="notes">(9)</span><ul><li><a href="allb0b4.html?cat=48">Jabber</a> <span class="notes">(4)</span></li>
<li><a href="all51fa.html?cat=40">Linux</a> <span class="notes">(9)</span><ul><li><a href="allffca.html?cat=41">My Gentoo</a> <span class="notes">(19)</span></li>
<li><a href="allf170.html?cat=53">Ubuntu@AMD64</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="all434a.html?cat=57">Workgroup Free Software</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="alle7dd.html?cat=59">Internet &amp; Blogs</a> <span class="notes">(12)</span></li>
<li><a href="alle8fb.html?cat=39">Life &amp; Fun</a> <span class="notes">(47)</span></li>
<li><a href="all1e3b.html?cat=55">Politics</a> <span class="notes">(16)</span><ul><li><a href="allfa15.html?cat=51">EU Software Patents</a> <span class="notes">(8)</span></li>
<li><a href="all848d.html?cat=58">N-VA</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="all667c.html?cat=43">Studies</a> <span class="notes">(23)</span><ul><li><a href="all493d.html?cat=62">Siemens</a> <span class="notes">(13)</span></li>
</ul>
</li>
<li><a href="alle868.html?cat=60">UGent &amp; Stuver</a> <span class="notes">(18)</span></li>
<li><a href="allac94.html?cat=42">VTK</a> <span class="notes">(10)</span></li>
</ul>

</div>
<div class="boxTop"><a href="all03a1.html?disp=comments">Last comments</a></div>
<div class="postBox">	

  <ul>
<li>- louboutin on <a href="ikke/2005/12/23/crosswords.html#c11861" title="permalink to comment">Crosswords</a>

</li>
<li>- rhinestone motif on <a href="ikke/2005/11/19/ooo2_on_770.html#c11860" title="permalink to comment">OOo2 on 770</a>

</li>
<li>- richard on <a href="ikke/2007/05/08/openoffice_rant.html#c11859" title="permalink to comment">OpenOffice rant</a>

</li>
<li>- Tom on <a href="ikke/2005/01/31/gob_signals_walkthrough.html#c11858" title="permalink to comment">GOB signals walkthrough</a>

</li>
<li>- Tom on <a href="ikke/2005/01/31/gob_signals_walkthrough.html#c11857" title="permalink to comment">GOB signals walkthrough</a>

</li>
        </ul>
</div>

<div class="postBox"><table class="bCalendarTable" cellspacing="0" summary="Monthly calendar with links to each day's posts">
<caption class="bCalendarCaption"><a href="all/2012/12/index.html" title="go to month's archive">December 2012</a></caption>
<thead><tr class="bCalendarRow">
<th class="bCalendarHeaderCell" abbr="Sunday" scope="col" title="Sunday">Sun</th>
<th class="bCalendarHeaderCell" abbr="Monday" scope="col" title="Monday">Mon</th>
<th class="bCalendarHeaderCell" abbr="Tuesday" scope="col" title="Tuesday">Tue</th>
<th class="bCalendarHeaderCell" abbr="Wednesday" scope="col" title="Wednesday">Wed</th>
<th class="bCalendarHeaderCell" abbr="Thursday" scope="col" title="Thursday">Thu</th>
<th class="bCalendarHeaderCell" abbr="Friday" scope="col" title="Friday">Fri</th>
<th class="bCalendarHeaderCell" abbr="Saturday" scope="col" title="Saturday">Sat</th>
</tr></thead>
<tfoot>
<tr>
<td colspan="3" id="prev"><a href="all/2007/12/index.html" title="Previous year (2007-12)">&lt;&lt;</a>&nbsp;<a href="all/2007/12/index.html" title="Previous month (2007-12)">&lt;</a></td>
<td class="pad">&nbsp;</td>
<td colspan="3" id="next">&nbsp;&nbsp;</td>
</tr>
</tfoot>
<tr class="bCalendarRow">
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarCell">1</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">2</td>
<td class="bCalendarCell">3</td>
<td class="bCalendarCell">4</td>
<td class="bCalendarCell">5</td>
<td class="bCalendarCell">6</td>
<td class="bCalendarCell">7</td>
<td class="bCalendarCell">8</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">9</td>
<td class="bCalendarCell">10</td>
<td id="bCalendarToday">11</td>
<td class="bCalendarCell">12</td>
<td class="bCalendarCell">13</td>
<td class="bCalendarCell">14</td>
<td class="bCalendarCell">15</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">16</td>
<td class="bCalendarCell">17</td>
<td class="bCalendarCell">18</td>
<td class="bCalendarCell">19</td>
<td class="bCalendarCell">20</td>
<td class="bCalendarCell">21</td>
<td class="bCalendarCell">22</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">23</td>
<td class="bCalendarCell">24</td>
<td class="bCalendarCell">25</td>
<td class="bCalendarCell">26</td>
<td class="bCalendarCell">27</td>
<td class="bCalendarCell">28</td>
<td class="bCalendarCell">29</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">30</td>
<td class="bCalendarCell">31</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
</tr>
</table></div>
<div class="postBox"><div class="boxTop">Archives</div><ul><li><a href="all/2007/12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="all/2007/10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="all/2007/08/index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="all/2007/05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="all/2007/03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="all/2007/02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2007/01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="all/2006/10/index.html">October 2006</a> <span class="dimmed">(2)</span></li>
<li><a href="all/2006/08/index.html">August 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="all1579.html?disp=arcdir">More...</a></li>
</ul>
</div>

<!-- =============== SEARCH BOX ======================== --> 
<div class="boxTop">Search</div>
<div class="postBox"><form action="http://blog.eikke.com/index.php/all" method="get" id="searchform">	<br />	<div align="center"><input class="search" size="15" name="s" /><br />
        <input type="submit" value="Search" name="submit" class="btn"  />
        </div>
</form>
</div>
<div class="postBox">
<h3 class="boxTop">Who's Online?</h3>
	<ul class="onlineUsers"><li>Guest Users: 463</li></ul>	</div>

			
<div class="boxTop">Syndicate this blog <img src="../img/xml.html" alt="XML" width="36" height="14" class="middle" /></div>               
	<div class="postBox">
RSS 0.92: <a href="http://eikke.com/feed/">Posts</a>, <a href="all7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
<br />
RSS 1.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="all374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
<br />
RSS 2.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="all6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
<br />
Atom: <a href="http://eikke.com/feed/">Posts</a>, <a href="all5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
</div>		

<!-- Menu footer -->
<br /> <div align="center">powered by<br />
<a href="http://b2evolution.net/" title="b2evolution home"><img src="../img/b2evolution_logo_80.html" alt="b2evolution" width="80" height="17" border="0" class="middle" /></a></div>
				</div>
						
						
				<div id="mainbar">

<!-- 
== START OF MAIN AREA
====== -->

<h2>05/19/05</h2><div class="bPost" lang="nl-BE">
		<div class="title"><a href="http://www.zdnet.be/news.cfm?id=45713">Microsoft demonstreert Apple G5 in plaats van de nieuwe Xbox</a></div>
	<div class="bText">
		<blockquote><p>De techsite Anandtech deed op de E3-beurs in Los Angeles een toch wel h</p>			</div>
         <div class="bSmallPrint">
	  <a href="http://peterdedecker.net/blog/index.php/2005/05/19/microsoft_demonstreert_apple_g5_in_plaat" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Peter</a>

          .
	  17:48:14	  .

          60 Words          .
	  
	<a href="http://peterdedecker.net/blog/index.php?cat=39" title="true">Life &amp; Fun</a>  
	.
	 <a href="all5ab1.html?disp=msgform&amp;recipient_id=8&amp;post_id=195&amp;redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%3Fblog%3D1%26amp%3Bpaged%3D56%26amp%3Bpage%3D1" title="Send email to post author"><img src="../rsc/icons/envelope.gif" border="0" align="top" width="13" height="10"  class="middle" title="Send email to post author" alt="Email"/></a> 	.
	No views	
		  	</div>
	</div>
<div class="bPost" lang="nl-BE">
		<div class="title"><a href="http://www.webwereld.nl/articles/35360">Phishing: boerenbedrog op het net</a></div>
	<div class="bText">
		<blockquote><p>Op straat spreekt een zwerver je aan. 'Ik ben van de Postbank', zegt hij beleefd. 'Onze computer is gecrasht, en ik kom controleren of uw pincode nog wel klopt. Kunt u hem even aan mij vertellen?'</p>

<p>Dom voorbeeld? Op internet vallen mensen massaal voor exact hetzelfde trucje. Zes procent van de ontvangers van zogenaamde phishing-mails klikt ten minste op de link in het bericht, zo blijkt uit cijfers van VeriSign. Daarna zijn zij nog maar </p>			</div>
         <div class="bSmallPrint">
	  <a href="http://peterdedecker.net/blog/index.php/2005/05/19/phishing_boerenbedrog_op_het_net" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Peter</a>

          .
	  17:43:25	  .

          222 Words          .
	  
	<a href="http://peterdedecker.net/blog/index.php?cat=59" title="true">Internet &amp; Blogs</a>  
	.
	 <a href="all9345.html?disp=msgform&amp;recipient_id=8&amp;post_id=194&amp;redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%3Fblog%3D1%26amp%3Bpaged%3D56%26amp%3Bpage%3D1" title="Send email to post author"><img src="../rsc/icons/envelope.gif" border="0" align="top" width="13" height="10"  class="middle" title="Send email to post author" alt="Email"/></a> 	.
	No views	
		  	</div>
	</div>
<div class="bPost" lang="en-US">
		<div class="title">GModules and vtables</div>
	<div class="bText">
		<p>After the <a href="ikke/2005/05/18/gmodules_are_fun.html" title="article">article</a> I posted yesterday on GModules, I just wrote some sample code using a vtable to look up functions, which makes module handling much easier.</p>

<p>I guess we better go straight to the code:</p>

<p>First we need to define some structure that represents our vtable. I did this in a common header file, vtable-common.h:</p>
<pre><code>#ifndef _VTABLE_COMMON_H
#define _VTABLE_COMMON_H

#include &lt;glib.h&gt;

typedef void (* voidvoidfunc) (void);
typedef gint (* intvoidfunc) (void);
typedef void (* voidstringfunc) (gchar *s);
typedef gboolean (* boolpstringfunc) (gchar **ps);
/* This function will demonstrate NULL function pointers */
typedef void (* foofunc) (void);

typedef struct VtableTest {
        voidvoidfunc funcone;
        intvoidfunc functwo;
        voidstringfunc functhree;
        boolpstringfunc funcfour;
        foofunc funcfive;
} VtableTest;

/* Module init function */
typedef VtableTest * (* VtableTestInit) (void);

#endif</code></pre>
<p>First we define typedefs for all function prototypes we want in our vtable, then we define the prototype of a module init function.</p>

<p>This may look a bit strange, let's take a look at the module code (in vtable-module.c) to see what we can do with this:</p>
<pre><code>#include &lt;glib.h&gt;
#include &lt;gmodule.h&gt;

#include "vtable-common.h"

/* Our vtable function implementations */
static void one() {
        g_print("[M] Function 1\n");
}

static gint two() {
        g_print("[M] Function 2\n");
        return 2;
}

static void three(gchar *s) {
        g_print("[M] Function 3: %s\n", s);
}

static gboolean four(gchar **s) {
        g_print("[M] Function 4\n");
        *s = g_strdup("four");
        return TRUE;
}

/* Our function table.
 * As you can see, we put functions in there as if they're normal variables */
static VtableTest table = {
        one,
        two,
        three,
        four,
        /* This module does not implement funcfive */
        NULL
};

/* This is the module init function.
 * It's a "VtableTestInit" function, as defined in vtable-common.h */
G_MODULE_EXPORT VtableTest * vtable_module_init() {
        g_debug("[M] Initializing module");
        /* Of course you can do a lot in this function,
         * we don't need to do anything in this sample */
        /* Return a reference to the function table */
        return &amp;table;
}</code></pre><p>The comments in the code should explain every step pretty well.<br />
As you can see we only export one function, vtable_module_init. This function got a fixed name (so we should define this name in our API). It returns a pointer to a vtable of type VtableTest, which includes pointers to all function implementations.</p>

<p>Last but not least is the main code, in vtable-main.c:</p>
<pre><code>#include &lt;glib.h&gt;
#include &lt;gmodule.h&gt;

#include "vtable-common.h"

gint main(gint argc, gchar *argv[]) {
        /* Same handles as yesterday */
        GModule *module = NULL;
        VtableTest *moduletable = NULL;
        gchar *modulepath = NULL, *dir = NULL;
        VtableTestInit moduleinitfunc = NULL;
        /* Function value */
        gint two = 0;
        gboolean fourb = FALSE;
        gchar *fours = NULL;
        
        /* Same stuff as yesterday */
        if(g_module_supported() == FALSE)
                g_error("No module support");

        dir = g_get_current_dir();
        modulepath = g_module_build_path((const gchar *) dir, "vtabletestmodule");
        g_debug("Module path: %s", modulepath);
        module = g_module_open(modulepath, G_MODULE_BIND_LAZY);
        g_free(dir);
        g_free(modulepath);
        if(module == NULL)
                g_error("Unable to load module");

        /* We need to lookup one function, which inits our vtable */
        if(g_module_symbol(module, "vtable_module_init", (gpointer *) &amp;moduleinitfunc) == FALSE) {
                g_error("Unable to get reference to the module init function: %s", g_module_error());
        }

        /* Get a reference to the module function table */
        moduletable = moduleinitfunc();

        /* Run all our functions, providing parameters or fetching return
         * values where necessary */
        if(moduletable->funcone != NULL) {
                g_debug("Running module funcone");
                moduletable->funcone();
        }
        else {
                g_warning("Funcone is NULL");
        }

        if(moduletable->functwo != NULL) {
                g_debug("Running module functwo");
                two = moduletable->functwo();
                g_debug("functwo returned %d", two);
        }
        else {
                g_warning("Functwo is NULL");
        }

        if(moduletable->functhree != NULL) {
                g_debug("Running module functhree");
                moduletable->functhree("vtable-module-test");
        }
        else {
                g_warning("Functhree is NULL");
        }

        if(moduletable->funcfour != NULL) {
                g_debug("Running module funcfour");
                fourb = moduletable->funcfour(&amp;fours);
                g_debug("funcfour returned \"%s\", string value is \"%s\"", fourb == TRUE? "true" : "false", fours);
        }
        else {
                g_warning("Funcfour is NULL");
        }

        if(moduletable->funcfive != NULL) {
                g_debug("Running module funcfive");
                moduletable->funcfive();
        }
        else {
                g_warning("Funcfive is NULL");
        }

        /* As yesterday, close the module */
        if(g_module_close(module) == FALSE) {
                g_error("Unable to close module: %s", g_module_error());
        }

        return 0;
}</code></pre><p>These are the steps we take:</p>
<ul><li>Load the module (see the previous article for more information on this)</li>
<li>Look up one symbol, "vtable_init_module". As mentioned before, this is the fixed name symbol that should be exported from our module.</li>
<li>run "vtable_module_init", so we get a reference to the module's vtable</li>
<li>Now we can use all functions refered to in the vtable. Make sure you always check for NULL pointers, or your application will crash. Even if your API/documentation states a module author <em>must</em> implement all vtable functions, checks don't hurt :-) Notice we call the functions using moduletable->foofunc(), so the vtable members are really normal function pointers, nothing fancy here.</li>
<li>We clean up by closing the module</li></ul>

<p>You can compile everything with this simple Makefile (yes I know it's a bad one):</p>
<pre><code>default: main libvtabletestmodule.so
all: default

main: vtable-main.c vtable-common.h
	gcc -o main -g `pkg-config --cflags --libs glib-2.0 gmodule-2.0` vtable-main.c

libvtabletestmodule.so: vtable-module.c vtable-common.h
	gcc -o libvtabletestmodule.so -g -shared `pkg-config --cflags --libs glib-2.0 gmodule-2.0` vtable-module.c</code></pre><p>or execute the commands by hand, of course.</p>

<p>Here's the output:</p>
<pre>** (process:16338): DEBUG: Module path: /home/foo/bar/vtable/libvtabletestmodule.so
** (process:16338): DEBUG: [M] Initializing module
** (process:16338): DEBUG: Running module funcone
[M] Function 1
** (process:16338): DEBUG: Running module functwo
[M] Function 2
** (process:16338): DEBUG: functwo returned 2
** (process:16338): DEBUG: Running module functhree
[M] Function 3: vtable-module-test
** (process:16338): DEBUG: Running module funcfour
[M] Function 4
** (process:16338): DEBUG: funcfour returned "true", string value is "four"

** (process:16338): WARNING **: Funcfive is NULL</pre>

<p>As you can see, all this is quite logical and easy to write once you figure out how to. The provided functionality can be very useful though.<br />
Notice thanks to glib, the code presented here should compile and run under Linux, Solaris and all other supported platforms (yes, even on Windows using DLL's) without any code change.</p>

<p>A little exercise for the reader: currently we got the module name "vtabletestmodule" hardcoded in vtable-main.c. What to do if we have several VtableTest implementations, e.g. vtabletestmodule1 and vtabletestmodule2? We could loop through all files in ".", find out whether they're a valid module (ie try to load them), if they're a valid module, try to figure out whether it exports "vtable_module_init", if that's the case, get a reference to the module's vtable, and use it. This is eg the way Gaim loads all it's plugins (although the module files aren't stored in "." of course). It's not too difficult to implement this, but the result is quite impressive too, so give it a try :-)</p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/05/19/gmodules_and_vtables.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  01:41:02 pm	  .

          1116 Words          .
	  
	<a href="ikke3f99.html?cat=16" title="true">Technology</a>, <a href="ikkec055.html?cat=17" title="true">Linux</a>, <a href="ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	389 views	
	 . <a href="ikke/2005/05/19/gmodules_and_vtables.html#comments" title="Display comments / Leave a comment">Leave a comment</a>	  	</div>
	</div>
<h2>05/18/05</h2><div class="bPost" lang="en-US">
		<div class="title">GModules are fun</div>
	<div class="bText">
		<p><a href="http://developer.gnome.org/doc/API/2.0/glib/" title="Glib">Glib</a>'s <a href="http://developer.gnome.org/doc/API/2.0/glib/glib-Dynamic-Loading-of-Modules.html" title="GModules">GModules</a> are fun :-) These functions provide a braindead interface to modular (think "plug-in based") programming. I wrote some testing code today (read the API a year ago or so but never played with it), here's a short introduction.</p>

<p>When writing module based applications there are mainly 2 parts: the modules, and the application using them. So we'll have to write these 2 things.</p>

<p>Getting started with the module is the easiest part:</p>

<pre><code>#include &lt;glib.h&gt;
#include &lt;gmodule.h&gt;

G_MODULE_EXPORT void m_helloworld() {
        g_print("Hello modular world!\n");
}</code></pre>

<p>This code is pretty straight-forward. The only "strange" thing is G_MODULE_EXPORT, a platform-independent macro telling the compiler/linker to export the function.</p>

<p>Then comes the "client" application, a little more difficult. Comments inline:</p>
<pre><code>#include &lt;glib.h&gt;
#include &lt;gmodule.h&gt;

/* A prototype of the function pointer we'll use */
/* void function(void) */
typedef void (*HelloWorldFunc) (void);

gint main(gint argc, gchar *argv[]) {
        /* We need:
         * - A handle to our module
         * - A pointer to the function we'll import
         * - Some helper strings */
        GModule *module = NULL;
        HelloWorldFunc hello = NULL;
        gchar *module_path = NULL, *curr = NULL;

        /* Check whether glib is compiled with module support */
        if(g_module_supported() == FALSE) {
                g_error("Modules not supported :(");
                return 1;
        }
        
        /* We need to figure out the path to our module. In our test case, this
         * is ".", so we want the current dir. */
        curr = g_get_current_dir();
        /* Create the path to the module. This function does quite a lot of
         * of things, check the GModule API. */
        module_path = g_module_build_path((const gchar *) curr, "module");
        /* Don't we love debugging? */
        g_debug("Module path: %s", module_path);

        /* Finally we're able to open the module. We want lazy symbol resolving.
         * This means we only want a symbol to be resolved if we request it.
         * Once more, see the API for more information. */
        module = g_module_open(module_path, G_MODULE_BIND_LAZY);

        /* Get rid of those helper strings */
        g_free(module_path);
        g_free(curr);

        /* Check whether the module was loaded successfully */
        if(module == NULL) {
                g_error("Unable to load module");
                return 1;
        }

        /* Load the symbol and assign it to our function pointer. 
         * Check for errors */
        if(g_module_symbol(module, "m_helloworld", (gpointer *) &amp;hello) == FALSE) {
                g_error("Unable to get function reference: %s", g_module_error());
                return 1;
        }

        /* Now we can call our funtion.
         * As you can see, we can call it as if it's a normal function.
         * Don't we love function pointers? */
        hello();

        /* We're nice citizens and close all references when we leave */
        if(g_module_close(module) == FALSE) {
                g_error("Unable to close module: %s", g_module_error());
                return 1;
        }

        return 0;
}</code></pre><p>(this looks like a lot of code (well...) but if you strip all comments and debugging stuff/checks, you'll only have 10 lines or so)</p>

<p>Should be quite easy to understand too.</p>

<p>Now it's compile time. Of course, in a real-world situation, we'd use autotools to compile our libraries, we'd have a libtoolized library etc etc etc. Here we'll do it in the quick-and-dirty way:</p>

<pre># gcc -o libmodule.so -shared `pkg-config --libs --cflags glib-2.0 gmodule-2.0` module.c
# gcc -o main `pkg-config --libs --cflags glib-2.0 gmodule-2.0` main.c
# ls
libmodule.so  main  main.c  module.c
# ./main
** (process:26533): DEBUG: Module path: /home/foo/bar/libmodule.so
Hello modular world!</pre>

<p>Loading all these symbols by hand is a boring task, so most of the time you'll create some API using vtables to make your life easier. More on this later (got to study now ;-) :|)</p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/05/18/gmodules_are_fun.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  04:02:11 pm	  .

          600 Words          .
	  
	<a href="ikke3f99.html?cat=16" title="true">Technology</a>, <a href="ikkec055.html?cat=17" title="true">Linux</a>, <a href="ikke8e7f.html?cat=19" title="true">Desktop</a>, <a href="ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	990 views	
	 . <a href="ikke/2005/05/18/gmodules_are_fun.html#comments" title="Display comments / Leave a comment">3 comments</a>	  	</div>
	</div>
<div class="bPost" lang="en-US">
		<div class="title">Portage on Windows</div>
	<div class="bText">
		<p>Maybe one day we'll be able to get lots of *nix software running under Windows using <a href="http://www.gentoo.org/" title="Gentoo">Gentoo</a>'s Portage. Read <a href="http://www.osnews.com/story.php?news_id=10616" title="this">this</a>.</p>			</div>
         <div class="bSmallPrint">
	  <a href="ikke/2005/05/18/portage_on_windows.html" title="Permanent link to full entry" class="permalink_right"><img src="../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  01:34:49 pm	  .

          37 Words          .
	  
	<a href="ikkeb5e7.html?cat=15" title="true">Life</a>  
	.
		.
	273 views	
	 . <a href="ikke/2005/05/18/portage_on_windows.html#comments" title="Display comments / Leave a comment">7 comments</a>	  	</div>
	</div>

<p class="center"><strong>
	<a href="all9225.html?blog=1&amp;page=1&amp;paged=55">&lt;&lt; Previous Page</a> :: <a href="all2f6b.html?blog=1&amp;page=1&amp;paged=57">Next Page &gt;&gt;</a>	</strong></p>

	
							
						
		  </div>
		
  </div>
  <br clear="all" />
  <div id="footer">
  <!-- This is the footer. Put all your copyright info here. -->
  <br />
  Design by <a href="http://www.jameskoster.co.uk/">James Koster</a>, Evoskin by <a href="http://www.brendoman.com/dbc">Danny Ferguson</a></div>
</center>
</body>

<!-- Mirrored from blog.eikke.com/index.php/all?blog=1&page=1&paged=56 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 20:06:27 GMT -->
</html>
