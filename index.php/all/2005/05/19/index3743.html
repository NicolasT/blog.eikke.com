<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<!-- Mirrored from blog.eikke.com/index.php/all/2005/05/19/?blog=1&m=20050519 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:53:55 GMT -->
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>
	All Blogs - Archives for: May  2005, 19</title>
<base  />
<meta name="description" content="" />
<meta name="keywords" content="ikke eikke blog" />
<meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
<link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
<link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
<link rel="pingback" href="../../../../../xmlsrv/xmlrpc.php" />
<link rel="stylesheet" href="../../../../../skins/plain/style.css" type="text/css" />

</head>

<body>
<a name="top" id="top"></a>
<center>
		<div id="menu">
				<a href="../../../../all.html" title="The blog front page">home</a>
<a href="../../../../../htsrv/login6792.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%2F2005%2F05%2F19%2F%3Fblog%3D1%26amp%3Bm%3D20050519" title="Login if you have an account...">Login...</a>
<a href="../../../../all03a1.html?disp=comments">Last comments</a>
		</div>
		
		<div id="header">


      <h1><a href="../../../../all.html" style="border:0px;">All Blogs</a></h1>
      <h2></h2>
		</div>
		
		<div id="content">
		
				
				<div id="sidebar">
<div class="submenu">
<div class="boxTop">&nbsp;</div><div class="menuBox"><a href="../../../../all.html" class="menuItem" title="All Blogs">Blog All</a>
<a href="../../../../ikke.html" class="menuItem" title="Ikke&#039;s Blog">Ikke</a>
<a href="../../../../fedorastateless.html" class="menuItem" title="Fedora Stateless @ UGent">FSU</a>
<a href="../../../../realnitro.html" class="menuItem" title="RealNitro&#039;s Blog">RealNitro</a>
<a href="http://peterdedecker.net/blog/index.php" class="menuItem" title="Peter&#039;s Blog">Peter</a>
</div></div>

		<p></p>
<div class="postBox"><div class="boxTop">Categories</div><h4><a href="../../../../all.html">All Blogs</a></h4>
<h4><a href="../../../../ikke.html">Ikke's Blog</a></h4>
<ul><li><a href="../../../../allb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="../../../../all3f99.html?cat=16">Technology</a> <span class="notes">(131)</span><ul><li><a href="../../../../all3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span><ul><li><a href="../../../../allbff0.html?cat=52">Docbook</a> <span class="notes">(7)</span></li>
<li><a href="../../../../alle864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span></li>
</ul>
</li>
<li><a href="../../../../all8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span></li>
<li><a href="../../../../all7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span></li>
<li><a href="../../../../allc055.html?cat=17">Linux</a> <span class="notes">(90)</span></li>
<li><a href="../../../../all6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span></li>
</ul>
</li>
</ul>
<h4><a href="../../../../fedorastateless.html">Fedora Stateless @ UGent</a></h4>
<ul><li><a href="../../../../allede2.html?cat=32">General</a> <span class="notes">(10)</span></li>
<li><a href="../../../../allb97c.html?cat=30">Nifty solutions</a> <span class="notes">(3)</span></li>
<li><a href="../../../../allaeb3.html?cat=29">Problems we encounter</a> <span class="notes">(9)</span></li>
<li><a href="../../../../allb60a.html?cat=27">Project status and progress</a> <span class="notes">(13)</span></li>
</ul>
<h4><a href="../../../../realnitro.html">RealNitro's Blog</a></h4>
<ul><li><a href="../../../../alld11d.html?cat=54">Coding</a> <span class="notes">(9)</span></li>
<li><a href="../../../../allc733.html?cat=38">Fun</a> <span class="notes">(2)</span></li>
<li><a href="../../../../all97dc.html?cat=33">Gaming</a> <span class="notes">(4)</span><ul><li><a href="../../../../all9ad7.html?cat=35">CUBE</a> <span class="notes">(3)</span></li>
<li><a href="../../../../all9591.html?cat=37">Max Payne</a> <span class="notes">(0)</span></li>
<li><a href="../../../../alla88f.html?cat=36">RTCW:ET</a> <span class="notes">(2)</span></li>
</ul>
</li>
<li><a href="../../../../allf528.html?cat=47">Life</a> <span class="notes">(11)</span></li>
<li><a href="../../../../all8dbd.html?cat=50">Linux</a> <span class="notes">(7)</span></li>
<li><a href="../../../../all489b.html?cat=34">Webdesign</a> <span class="notes">(4)</span></li>
</ul>
<h4><a href="http://peterdedecker.net/blog/index.php">Peter's Blog</a></h4>
<ul><li><a href="../../../../all363a.html?cat=45">Free Software</a> <span class="notes">(9)</span><ul><li><a href="../../../../allb0b4.html?cat=48">Jabber</a> <span class="notes">(4)</span></li>
<li><a href="../../../../all51fa.html?cat=40">Linux</a> <span class="notes">(9)</span><ul><li><a href="../../../../allffca.html?cat=41">My Gentoo</a> <span class="notes">(19)</span></li>
<li><a href="../../../../allf170.html?cat=53">Ubuntu@AMD64</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="../../../../all434a.html?cat=57">Workgroup Free Software</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="../../../../alle7dd.html?cat=59">Internet &amp; Blogs</a> <span class="notes">(12)</span></li>
<li><a href="../../../../alle8fb.html?cat=39">Life &amp; Fun</a> <span class="notes">(47)</span></li>
<li><a href="../../../../all1e3b.html?cat=55">Politics</a> <span class="notes">(16)</span><ul><li><a href="../../../../allfa15.html?cat=51">EU Software Patents</a> <span class="notes">(8)</span></li>
<li><a href="../../../../all848d.html?cat=58">N-VA</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="../../../../all667c.html?cat=43">Studies</a> <span class="notes">(23)</span><ul><li><a href="../../../../all493d.html?cat=62">Siemens</a> <span class="notes">(13)</span></li>
</ul>
</li>
<li><a href="../../../../alle868.html?cat=60">UGent &amp; Stuver</a> <span class="notes">(18)</span></li>
<li><a href="../../../../allac94.html?cat=42">VTK</a> <span class="notes">(10)</span></li>
</ul>

</div>
<div class="boxTop"><a href="../../../../all03a1.html?disp=comments">Last comments</a></div>
<div class="postBox">	

  <ul>
<li>- louboutin on <a href="../../../../ikke/2005/12/23/crosswords.html#c11861" title="permalink to comment">Crosswords</a>

</li>
<li>- rhinestone motif on <a href="../../../../ikke/2005/11/19/ooo2_on_770.html#c11860" title="permalink to comment">OOo2 on 770</a>

</li>
<li>- richard on <a href="../../../../ikke/2007/05/08/openoffice_rant.html#c11859" title="permalink to comment">OpenOffice rant</a>

</li>
<li>- Tom on <a href="../../../../ikke/2005/01/31/gob_signals_walkthrough.html#c11858" title="permalink to comment">GOB signals walkthrough</a>

</li>
<li>- Tom on <a href="../../../../ikke/2005/01/31/gob_signals_walkthrough.html#c11857" title="permalink to comment">GOB signals walkthrough</a>

</li>
        </ul>
</div>

<div class="postBox"><table class="bCalendarTable" cellspacing="0" summary="Monthly calendar with links to each day's posts">
<caption class="bCalendarCaption"><a href="../index.html" title="go to month's archive">May  2005</a></caption>
<thead><tr class="bCalendarRow">
<th class="bCalendarHeaderCell" abbr="Sunday" scope="col" title="Sunday">Sun</th>
<th class="bCalendarHeaderCell" abbr="Monday" scope="col" title="Monday">Mon</th>
<th class="bCalendarHeaderCell" abbr="Tuesday" scope="col" title="Tuesday">Tue</th>
<th class="bCalendarHeaderCell" abbr="Wednesday" scope="col" title="Wednesday">Wed</th>
<th class="bCalendarHeaderCell" abbr="Thursday" scope="col" title="Thursday">Thu</th>
<th class="bCalendarHeaderCell" abbr="Friday" scope="col" title="Friday">Fri</th>
<th class="bCalendarHeaderCell" abbr="Saturday" scope="col" title="Saturday">Sat</th>
</tr></thead>
<tfoot>
<tr>
<td colspan="2" id="prev"><a href="../../../2004/11/index.html" title="Previous year (2004-11)">&lt;&lt;</a>&nbsp;<a href="../../04/index.html" title="Previous month (2005-04)">&lt;</a></td>
<td colspan="3" class="center"><a href="../../../2012/12/index.html">Current</a></td><td colspan="2" id="next">&nbsp;<a href="../../06/index.html" title="Next month (2005-06)">&gt;</a>&nbsp;<a href="../../../2006/05/index.html" title="Next year (2006-05)">&gt;&gt;</a></td>
</tr>
</tfoot>
<tr class="bCalendarRow">
<td class="bCalendarLinkPost"><a href="../01/index.html" title="3 posts">1</a></td>
<td class="bCalendarLinkPost"><a href="../02/index.html" title="2 posts">2</a></td>
<td class="bCalendarLinkPost"><a href="../03/index.html" title="2 posts">3</a></td>
<td class="bCalendarLinkPost"><a href="../04/index.html" title="2 posts">4</a></td>
<td class="bCalendarLinkPost"><a href="../05/index.html" title="1 post">5</a></td>
<td class="bCalendarLinkPost"><a href="../06/index.html" title="5 posts">6</a></td>
<td class="bCalendarLinkPost"><a href="../07/index.html" title="1 post">7</a></td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">8</td>
<td class="bCalendarLinkPost"><a href="../09/index.html" title="1 post">9</a></td>
<td class="bCalendarCell">10</td>
<td class="bCalendarCell">11</td>
<td class="bCalendarLinkPost"><a href="../12/index.html" title="1 post">12</a></td>
<td class="bCalendarLinkPost"><a href="../13/index.html" title="3 posts">13</a></td>
<td class="bCalendarCell">14</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarLinkPost"><a href="../15/index.html" title="3 posts">15</a></td>
<td class="bCalendarLinkPost"><a href="../16/index.html" title="1 post">16</a></td>
<td class="bCalendarLinkPost"><a href="../17/index.html" title="1 post">17</a></td>
<td class="bCalendarLinkPost"><a href="../18/index.html" title="3 posts">18</a></td>
<td class="bCalendarLinkPost"><a href="index.html" title="3 posts">19</a></td>
<td class="bCalendarCell">20</td>
<td class="bCalendarLinkPost"><a href="../21/index.html" title="3 posts">21</a></td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarLinkPost"><a href="../22/index.html" title="2 posts">22</a></td>
<td class="bCalendarLinkPost"><a href="../23/index.html" title="1 post">23</a></td>
<td class="bCalendarLinkPost"><a href="../24/index.html" title="3 posts">24</a></td>
<td class="bCalendarLinkPost"><a href="../25/index.html" title="2 posts">25</a></td>
<td class="bCalendarCell">26</td>
<td class="bCalendarLinkPost"><a href="../27/index.html" title="1 post">27</a></td>
<td class="bCalendarCell">28</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarLinkPost"><a href="../29/index.html" title="2 posts">29</a></td>
<td class="bCalendarLinkPost"><a href="../30/index.html" title="2 posts">30</a></td>
<td class="bCalendarCell">31</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
</tr>
</table></div>
<div class="postBox"><div class="boxTop">Archives</div><ul><li><a href="../../../2007/12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../../2007/11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../../../2007/10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../../2007/09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../../../2007/08/index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="../../../2007/05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../../2007/04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="../../../2007/03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="../../../2007/02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../../2007/01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../../../2006/10/index.html">October 2006</a> <span class="dimmed">(2)</span></li>
<li><a href="../../../2006/08/index.html">August 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="../../../../all1579.html?disp=arcdir">More...</a></li>
</ul>
</div>

<!-- =============== SEARCH BOX ======================== --> 
<div class="boxTop">Search</div>
<div class="postBox"><form action="http://blog.eikke.com/index.php/all" method="get" id="searchform">	<br />	<div align="center"><input class="search" size="15" name="s" /><br />
        <input type="submit" value="Search" name="submit" class="btn"  />
        </div>
</form>
</div>
<div class="postBox">
<h3 class="boxTop">Who's Online?</h3>
	<ul class="onlineUsers"><li>Guest Users: 229</li></ul>	</div>

			
<div class="boxTop">Syndicate this blog <img src="../../../../../img/xml.html" alt="XML" width="36" height="14" class="middle" /></div>               
	<div class="postBox">
RSS 0.92: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../../all7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
<br />
RSS 1.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../../all374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
<br />
RSS 2.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../../all6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
<br />
Atom: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../../all5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
</div>		

<!-- Menu footer -->
<br /> <div align="center">powered by<br />
<a href="http://b2evolution.net/" title="b2evolution home"><img src="../../../../../img/b2evolution_logo_80.html" alt="b2evolution" width="80" height="17" border="0" class="middle" /></a></div>
				</div>
						
						
				<div id="mainbar">

<h2>Archives for: May  <a href="../../index.html">2005</a>, 19</h2><!-- 
== START OF MAIN AREA
====== -->

<h2>05/19/05</h2><div class="bPost" lang="nl-BE">
		<div class="title"><a href="http://www.zdnet.be/news.cfm?id=45713">Microsoft demonstreert Apple G5 in plaats van de nieuwe Xbox</a></div>
	<div class="bText">
		<blockquote><p>De techsite Anandtech deed op de E3-beurs in Los Angeles een toch wel h</p>			</div>
         <div class="bSmallPrint">
	  <a href="http://peterdedecker.net/blog/index.php/2005/05/19/microsoft_demonstreert_apple_g5_in_plaat" title="Permanent link to full entry" class="permalink_right"><img src="../../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../../all7441.html?author=" title="Browse all posts by this author">Peter</a>

          .
	  17:48:14	  .

          60 Words          .
	  
	<a href="http://peterdedecker.net/blog/index.php?cat=39" title="true">Life &amp; Fun</a>  
	.
	 <a href="../../../../allc2ce.html?disp=msgform&amp;recipient_id=8&amp;post_id=195&amp;redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%2F2005%2F05%2F19%2F%3Fblog%3D1%26amp%3Bm%3D20050519%26amp%3Bpage%3D1" title="Send email to post author"><img src="../../../../../rsc/icons/envelope.gif" border="0" align="top" width="13" height="10"  class="middle" title="Send email to post author" alt="Email"/></a> 	.
	No views	
		  	</div>
	</div>
<div class="bPost" lang="nl-BE">
		<div class="title"><a href="http://www.webwereld.nl/articles/35360">Phishing: boerenbedrog op het net</a></div>
	<div class="bText">
		<blockquote><p>Op straat spreekt een zwerver je aan. 'Ik ben van de Postbank', zegt hij beleefd. 'Onze computer is gecrasht, en ik kom controleren of uw pincode nog wel klopt. Kunt u hem even aan mij vertellen?'</p>

<p>Dom voorbeeld? Op internet vallen mensen massaal voor exact hetzelfde trucje. Zes procent van de ontvangers van zogenaamde phishing-mails klikt ten minste op de link in het bericht, zo blijkt uit cijfers van VeriSign. Daarna zijn zij nog maar </p>			</div>
         <div class="bSmallPrint">
	  <a href="http://peterdedecker.net/blog/index.php/2005/05/19/phishing_boerenbedrog_op_het_net" title="Permanent link to full entry" class="permalink_right"><img src="../../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../../all7441.html?author=" title="Browse all posts by this author">Peter</a>

          .
	  17:43:25	  .

          222 Words          .
	  
	<a href="http://peterdedecker.net/blog/index.php?cat=59" title="true">Internet &amp; Blogs</a>  
	.
	 <a href="../../../../all24fe.html?disp=msgform&amp;recipient_id=8&amp;post_id=194&amp;redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%2F2005%2F05%2F19%2F%3Fblog%3D1%26amp%3Bm%3D20050519%26amp%3Bpage%3D1" title="Send email to post author"><img src="../../../../../rsc/icons/envelope.gif" border="0" align="top" width="13" height="10"  class="middle" title="Send email to post author" alt="Email"/></a> 	.
	No views	
		  	</div>
	</div>
<div class="bPost" lang="en-US">
		<div class="title">GModules and vtables</div>
	<div class="bText">
		<p>After the <a href="../../../../ikke/2005/05/18/gmodules_are_fun.html" title="article">article</a> I posted yesterday on GModules, I just wrote some sample code using a vtable to look up functions, which makes module handling much easier.</p>

<p>I guess we better go straight to the code:</p>

<p>First we need to define some structure that represents our vtable. I did this in a common header file, vtable-common.h:</p>
<pre><code>#ifndef _VTABLE_COMMON_H
#define _VTABLE_COMMON_H

#include &lt;glib.h&gt;

typedef void (* voidvoidfunc) (void);
typedef gint (* intvoidfunc) (void);
typedef void (* voidstringfunc) (gchar *s);
typedef gboolean (* boolpstringfunc) (gchar **ps);
/* This function will demonstrate NULL function pointers */
typedef void (* foofunc) (void);

typedef struct VtableTest {
        voidvoidfunc funcone;
        intvoidfunc functwo;
        voidstringfunc functhree;
        boolpstringfunc funcfour;
        foofunc funcfive;
} VtableTest;

/* Module init function */
typedef VtableTest * (* VtableTestInit) (void);

#endif</code></pre>
<p>First we define typedefs for all function prototypes we want in our vtable, then we define the prototype of a module init function.</p>

<p>This may look a bit strange, let's take a look at the module code (in vtable-module.c) to see what we can do with this:</p>
<pre><code>#include &lt;glib.h&gt;
#include &lt;gmodule.h&gt;

#include "vtable-common.h"

/* Our vtable function implementations */
static void one() {
        g_print("[M] Function 1\n");
}

static gint two() {
        g_print("[M] Function 2\n");
        return 2;
}

static void three(gchar *s) {
        g_print("[M] Function 3: %s\n", s);
}

static gboolean four(gchar **s) {
        g_print("[M] Function 4\n");
        *s = g_strdup("four");
        return TRUE;
}

/* Our function table.
 * As you can see, we put functions in there as if they're normal variables */
static VtableTest table = {
        one,
        two,
        three,
        four,
        /* This module does not implement funcfive */
        NULL
};

/* This is the module init function.
 * It's a "VtableTestInit" function, as defined in vtable-common.h */
G_MODULE_EXPORT VtableTest * vtable_module_init() {
        g_debug("[M] Initializing module");
        /* Of course you can do a lot in this function,
         * we don't need to do anything in this sample */
        /* Return a reference to the function table */
        return &amp;table;
}</code></pre><p>The comments in the code should explain every step pretty well.<br />
As you can see we only export one function, vtable_module_init. This function got a fixed name (so we should define this name in our API). It returns a pointer to a vtable of type VtableTest, which includes pointers to all function implementations.</p>

<p>Last but not least is the main code, in vtable-main.c:</p>
<pre><code>#include &lt;glib.h&gt;
#include &lt;gmodule.h&gt;

#include "vtable-common.h"

gint main(gint argc, gchar *argv[]) {
        /* Same handles as yesterday */
        GModule *module = NULL;
        VtableTest *moduletable = NULL;
        gchar *modulepath = NULL, *dir = NULL;
        VtableTestInit moduleinitfunc = NULL;
        /* Function value */
        gint two = 0;
        gboolean fourb = FALSE;
        gchar *fours = NULL;
        
        /* Same stuff as yesterday */
        if(g_module_supported() == FALSE)
                g_error("No module support");

        dir = g_get_current_dir();
        modulepath = g_module_build_path((const gchar *) dir, "vtabletestmodule");
        g_debug("Module path: %s", modulepath);
        module = g_module_open(modulepath, G_MODULE_BIND_LAZY);
        g_free(dir);
        g_free(modulepath);
        if(module == NULL)
                g_error("Unable to load module");

        /* We need to lookup one function, which inits our vtable */
        if(g_module_symbol(module, "vtable_module_init", (gpointer *) &amp;moduleinitfunc) == FALSE) {
                g_error("Unable to get reference to the module init function: %s", g_module_error());
        }

        /* Get a reference to the module function table */
        moduletable = moduleinitfunc();

        /* Run all our functions, providing parameters or fetching return
         * values where necessary */
        if(moduletable->funcone != NULL) {
                g_debug("Running module funcone");
                moduletable->funcone();
        }
        else {
                g_warning("Funcone is NULL");
        }

        if(moduletable->functwo != NULL) {
                g_debug("Running module functwo");
                two = moduletable->functwo();
                g_debug("functwo returned %d", two);
        }
        else {
                g_warning("Functwo is NULL");
        }

        if(moduletable->functhree != NULL) {
                g_debug("Running module functhree");
                moduletable->functhree("vtable-module-test");
        }
        else {
                g_warning("Functhree is NULL");
        }

        if(moduletable->funcfour != NULL) {
                g_debug("Running module funcfour");
                fourb = moduletable->funcfour(&amp;fours);
                g_debug("funcfour returned \"%s\", string value is \"%s\"", fourb == TRUE? "true" : "false", fours);
        }
        else {
                g_warning("Funcfour is NULL");
        }

        if(moduletable->funcfive != NULL) {
                g_debug("Running module funcfive");
                moduletable->funcfive();
        }
        else {
                g_warning("Funcfive is NULL");
        }

        /* As yesterday, close the module */
        if(g_module_close(module) == FALSE) {
                g_error("Unable to close module: %s", g_module_error());
        }

        return 0;
}</code></pre><p>These are the steps we take:</p>
<ul><li>Load the module (see the previous article for more information on this)</li>
<li>Look up one symbol, "vtable_init_module". As mentioned before, this is the fixed name symbol that should be exported from our module.</li>
<li>run "vtable_module_init", so we get a reference to the module's vtable</li>
<li>Now we can use all functions refered to in the vtable. Make sure you always check for NULL pointers, or your application will crash. Even if your API/documentation states a module author <em>must</em> implement all vtable functions, checks don't hurt :-) Notice we call the functions using moduletable->foofunc(), so the vtable members are really normal function pointers, nothing fancy here.</li>
<li>We clean up by closing the module</li></ul>

<p>You can compile everything with this simple Makefile (yes I know it's a bad one):</p>
<pre><code>default: main libvtabletestmodule.so
all: default

main: vtable-main.c vtable-common.h
	gcc -o main -g `pkg-config --cflags --libs glib-2.0 gmodule-2.0` vtable-main.c

libvtabletestmodule.so: vtable-module.c vtable-common.h
	gcc -o libvtabletestmodule.so -g -shared `pkg-config --cflags --libs glib-2.0 gmodule-2.0` vtable-module.c</code></pre><p>or execute the commands by hand, of course.</p>

<p>Here's the output:</p>
<pre>** (process:16338): DEBUG: Module path: /home/foo/bar/vtable/libvtabletestmodule.so
** (process:16338): DEBUG: [M] Initializing module
** (process:16338): DEBUG: Running module funcone
[M] Function 1
** (process:16338): DEBUG: Running module functwo
[M] Function 2
** (process:16338): DEBUG: functwo returned 2
** (process:16338): DEBUG: Running module functhree
[M] Function 3: vtable-module-test
** (process:16338): DEBUG: Running module funcfour
[M] Function 4
** (process:16338): DEBUG: funcfour returned "true", string value is "four"

** (process:16338): WARNING **: Funcfive is NULL</pre>

<p>As you can see, all this is quite logical and easy to write once you figure out how to. The provided functionality can be very useful though.<br />
Notice thanks to glib, the code presented here should compile and run under Linux, Solaris and all other supported platforms (yes, even on Windows using DLL's) without any code change.</p>

<p>A little exercise for the reader: currently we got the module name "vtabletestmodule" hardcoded in vtable-main.c. What to do if we have several VtableTest implementations, e.g. vtabletestmodule1 and vtabletestmodule2? We could loop through all files in ".", find out whether they're a valid module (ie try to load them), if they're a valid module, try to figure out whether it exports "vtable_module_init", if that's the case, get a reference to the module's vtable, and use it. This is eg the way Gaim loads all it's plugins (although the module files aren't stored in "." of course). It's not too difficult to implement this, but the result is quite impressive too, so give it a try :-)</p>			</div>
         <div class="bSmallPrint">
	  <a href="../../../../ikke/2005/05/19/gmodules_and_vtables.html" title="Permanent link to full entry" class="permalink_right"><img src="../../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../../all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  01:41:02 pm	  .

          1116 Words          .
	  
	<a href="../../../../ikke3f99.html?cat=16" title="true">Technology</a>, <a href="../../../../ikkec055.html?cat=17" title="true">Linux</a>, <a href="../../../../ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	389 views	
	 . <a href="../../../../ikke/2005/05/19/gmodules_and_vtables.html#comments" title="Display comments / Leave a comment">Leave a comment</a>	  	</div>
	</div>

<p class="center"><strong>
		</strong></p>

	
							
						
		  </div>
		
  </div>
  <br clear="all" />
  <div id="footer">
  <!-- This is the footer. Put all your copyright info here. -->
  <br />
  Design by <a href="http://www.jameskoster.co.uk/">James Koster</a>, Evoskin by <a href="http://www.brendoman.com/dbc">Danny Ferguson</a></div>
</center>
</body>

<!-- Mirrored from blog.eikke.com/index.php/all/2005/05/19/?blog=1&m=20050519 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:53:55 GMT -->
</html>
