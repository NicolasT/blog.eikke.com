<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<!-- Mirrored from blog.eikke.com/index.php/all/2007/08/?blog=1&m=200708 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:27:16 GMT -->
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>
	All Blogs - Archives for: August 2007</title>
<base  />
<meta name="description" content="" />
<meta name="keywords" content="ikke eikke blog" />
<meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
<link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
<link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
<link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
<link rel="pingback" href="../../../../xmlsrv/xmlrpc.php" />
<link rel="stylesheet" href="../../../../skins/plain/style.css" type="text/css" />

</head>

<body>
<a name="top" id="top"></a>
<center>
		<div id="menu">
				<a href="../../../all.html" title="The blog front page">home</a>
<a href="../../../../htsrv/loginca98.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fall%2F2007%2F08%2F%3Fblog%3D1%26amp%3Bm%3D200708" title="Login if you have an account...">Login...</a>
<a href="../../../all03a1.html?disp=comments">Last comments</a>
		</div>
		
		<div id="header">


      <h1><a href="../../../all.html" style="border:0px;">All Blogs</a></h1>
      <h2></h2>
		</div>
		
		<div id="content">
		
				
				<div id="sidebar">
<div class="submenu">
<div class="boxTop">&nbsp;</div><div class="menuBox"><a href="../../../all.html" class="menuItem" title="All Blogs">Blog All</a>
<a href="../../../ikke.html" class="menuItem" title="Ikke&#039;s Blog">Ikke</a>
<a href="../../../fedorastateless.html" class="menuItem" title="Fedora Stateless @ UGent">FSU</a>
<a href="../../../realnitro.html" class="menuItem" title="RealNitro&#039;s Blog">RealNitro</a>
<a href="http://peterdedecker.net/blog/index.php" class="menuItem" title="Peter&#039;s Blog">Peter</a>
</div></div>

		<p></p>
<div class="postBox"><div class="boxTop">Categories</div><h4><a href="../../../all.html">All Blogs</a></h4>
<h4><a href="../../../ikke.html">Ikke's Blog</a></h4>
<ul><li><a href="../../../allb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="../../../all3f99.html?cat=16">Technology</a> <span class="notes">(131)</span><ul><li><a href="../../../all3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span><ul><li><a href="../../../allbff0.html?cat=52">Docbook</a> <span class="notes">(7)</span></li>
<li><a href="../../../alle864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span></li>
</ul>
</li>
<li><a href="../../../all8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span></li>
<li><a href="../../../all7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span></li>
<li><a href="../../../allc055.html?cat=17">Linux</a> <span class="notes">(90)</span></li>
<li><a href="../../../all6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span></li>
</ul>
</li>
</ul>
<h4><a href="../../../fedorastateless.html">Fedora Stateless @ UGent</a></h4>
<ul><li><a href="../../../allede2.html?cat=32">General</a> <span class="notes">(10)</span></li>
<li><a href="../../../allb97c.html?cat=30">Nifty solutions</a> <span class="notes">(3)</span></li>
<li><a href="../../../allaeb3.html?cat=29">Problems we encounter</a> <span class="notes">(9)</span></li>
<li><a href="../../../allb60a.html?cat=27">Project status and progress</a> <span class="notes">(13)</span></li>
</ul>
<h4><a href="../../../realnitro.html">RealNitro's Blog</a></h4>
<ul><li><a href="../../../alld11d.html?cat=54">Coding</a> <span class="notes">(9)</span></li>
<li><a href="../../../allc733.html?cat=38">Fun</a> <span class="notes">(2)</span></li>
<li><a href="../../../all97dc.html?cat=33">Gaming</a> <span class="notes">(4)</span><ul><li><a href="../../../all9ad7.html?cat=35">CUBE</a> <span class="notes">(3)</span></li>
<li><a href="../../../all9591.html?cat=37">Max Payne</a> <span class="notes">(0)</span></li>
<li><a href="../../../alla88f.html?cat=36">RTCW:ET</a> <span class="notes">(2)</span></li>
</ul>
</li>
<li><a href="../../../allf528.html?cat=47">Life</a> <span class="notes">(11)</span></li>
<li><a href="../../../all8dbd.html?cat=50">Linux</a> <span class="notes">(7)</span></li>
<li><a href="../../../all489b.html?cat=34">Webdesign</a> <span class="notes">(4)</span></li>
</ul>
<h4><a href="http://peterdedecker.net/blog/index.php">Peter's Blog</a></h4>
<ul><li><a href="../../../all363a.html?cat=45">Free Software</a> <span class="notes">(9)</span><ul><li><a href="../../../allb0b4.html?cat=48">Jabber</a> <span class="notes">(4)</span></li>
<li><a href="../../../all51fa.html?cat=40">Linux</a> <span class="notes">(9)</span><ul><li><a href="../../../allffca.html?cat=41">My Gentoo</a> <span class="notes">(19)</span></li>
<li><a href="../../../allf170.html?cat=53">Ubuntu@AMD64</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="../../../all434a.html?cat=57">Workgroup Free Software</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="../../../alle7dd.html?cat=59">Internet &amp; Blogs</a> <span class="notes">(12)</span></li>
<li><a href="../../../alle8fb.html?cat=39">Life &amp; Fun</a> <span class="notes">(47)</span></li>
<li><a href="../../../all1e3b.html?cat=55">Politics</a> <span class="notes">(16)</span><ul><li><a href="../../../allfa15.html?cat=51">EU Software Patents</a> <span class="notes">(8)</span></li>
<li><a href="../../../all848d.html?cat=58">N-VA</a> <span class="notes">(4)</span></li>
</ul>
</li>
<li><a href="../../../all667c.html?cat=43">Studies</a> <span class="notes">(23)</span><ul><li><a href="../../../all493d.html?cat=62">Siemens</a> <span class="notes">(13)</span></li>
</ul>
</li>
<li><a href="../../../alle868.html?cat=60">UGent &amp; Stuver</a> <span class="notes">(18)</span></li>
<li><a href="../../../allac94.html?cat=42">VTK</a> <span class="notes">(10)</span></li>
</ul>

</div>
<div class="boxTop"><a href="../../../all03a1.html?disp=comments">Last comments</a></div>
<div class="postBox">	

  <ul>
<li>- louboutin on <a href="../../../ikke/2005/12/23/crosswords.html#c11861" title="permalink to comment">Crosswords</a>

</li>
<li>- rhinestone motif on <a href="../../../ikke/2005/11/19/ooo2_on_770.html#c11860" title="permalink to comment">OOo2 on 770</a>

</li>
<li>- richard on <a href="../../../ikke/2007/05/08/openoffice_rant.html#c11859" title="permalink to comment">OpenOffice rant</a>

</li>
<li>- Tom on <a href="../../../ikke/2005/01/31/gob_signals_walkthrough.html#c11858" title="permalink to comment">GOB signals walkthrough</a>

</li>
<li>- Tom on <a href="../../../ikke/2005/01/31/gob_signals_walkthrough.html#c11857" title="permalink to comment">GOB signals walkthrough</a>

</li>
        </ul>
</div>

<div class="postBox"><table class="bCalendarTable" cellspacing="0" summary="Monthly calendar with links to each day's posts">
<caption class="bCalendarCaption"><a href="index.html" title="go to month's archive">August 2007</a></caption>
<thead><tr class="bCalendarRow">
<th class="bCalendarHeaderCell" abbr="Sunday" scope="col" title="Sunday">Sun</th>
<th class="bCalendarHeaderCell" abbr="Monday" scope="col" title="Monday">Mon</th>
<th class="bCalendarHeaderCell" abbr="Tuesday" scope="col" title="Tuesday">Tue</th>
<th class="bCalendarHeaderCell" abbr="Wednesday" scope="col" title="Wednesday">Wed</th>
<th class="bCalendarHeaderCell" abbr="Thursday" scope="col" title="Thursday">Thu</th>
<th class="bCalendarHeaderCell" abbr="Friday" scope="col" title="Friday">Fri</th>
<th class="bCalendarHeaderCell" abbr="Saturday" scope="col" title="Saturday">Sat</th>
</tr></thead>
<tfoot>
<tr>
<td colspan="2" id="prev"><a href="../../2006/08/index.html" title="Previous year (2006-08)">&lt;&lt;</a>&nbsp;<a href="../05/index.html" title="Previous month (2007-05)">&lt;</a></td>
<td colspan="3" class="center"><a href="../../2012/12/index.html">Current</a></td><td colspan="2" id="next">&nbsp;<a href="../09/index.html" title="Next month (2007-09)">&gt;</a>&nbsp;</td>
</tr>
</tfoot>
<tr class="bCalendarRow">
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
<td class="bCalendarCell">1</td>
<td class="bCalendarCell">2</td>
<td class="bCalendarCell">3</td>
<td class="bCalendarCell">4</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">5</td>
<td class="bCalendarCell">6</td>
<td class="bCalendarCell">7</td>
<td class="bCalendarCell">8</td>
<td class="bCalendarLinkPost"><a href="09/index.html" title="1 post">9</a></td>
<td class="bCalendarCell">10</td>
<td class="bCalendarCell">11</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">12</td>
<td class="bCalendarCell">13</td>
<td class="bCalendarCell">14</td>
<td class="bCalendarLinkPost"><a href="15/index.html" title="2 posts">15</a></td>
<td class="bCalendarCell">16</td>
<td class="bCalendarCell">17</td>
<td class="bCalendarCell">18</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">19</td>
<td class="bCalendarCell">20</td>
<td class="bCalendarCell">21</td>
<td class="bCalendarLinkPost"><a href="22/index.html" title="1 post">22</a></td>
<td class="bCalendarCell">23</td>
<td class="bCalendarCell">24</td>
<td class="bCalendarCell">25</td>
</tr>
<tr class="bCalendarRow">
<td class="bCalendarCell">26</td>
<td class="bCalendarCell">27</td>
<td class="bCalendarCell">28</td>
<td class="bCalendarCell">29</td>
<td class="bCalendarCell">30</td>
<td class="bCalendarCell">31</td>
<td class="bCalendarEmptyCell">&nbsp;</td>
</tr>
</table></div>
<div class="postBox"><div class="boxTop">Archives</div><ul><li><a href="../12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="../05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="../03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="../02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../../2006/10/index.html">October 2006</a> <span class="dimmed">(2)</span></li>
<li><a href="../../2006/08/index.html">August 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="../../../all1579.html?disp=arcdir">More...</a></li>
</ul>
</div>

<!-- =============== SEARCH BOX ======================== --> 
<div class="boxTop">Search</div>
<div class="postBox"><form action="http://blog.eikke.com/index.php/all" method="get" id="searchform">	<br />	<div align="center"><input class="search" size="15" name="s" /><br />
        <input type="submit" value="Search" name="submit" class="btn"  />
        </div>
</form>
</div>
<div class="postBox">
<h3 class="boxTop">Who's Online?</h3>
	<ul class="onlineUsers"><li>Guest Users: 509</li></ul>	</div>

			
<div class="boxTop">Syndicate this blog <img src="../../../../img/xml.html" alt="XML" width="36" height="14" class="middle" /></div>               
	<div class="postBox">
RSS 0.92: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../all7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
<br />
RSS 1.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../all374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
<br />
RSS 2.0: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../all6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
<br />
Atom: <a href="http://eikke.com/feed/">Posts</a>, <a href="../../../all5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
</div>		

<!-- Menu footer -->
<br /> <div align="center">powered by<br />
<a href="http://b2evolution.net/" title="b2evolution home"><img src="../../../../img/b2evolution_logo_80.html" alt="b2evolution" width="80" height="17" border="0" class="middle" /></a></div>
				</div>
						
						
				<div id="mainbar">

<h2>Archives for: August <a href="../index.html">2007</a></h2><!-- 
== START OF MAIN AREA
====== -->

<h2>08/22/07</h2><div class="bPost" lang="en-US">
		<div class="title">ReST + git + hooks = useful</div>
	<div class="bText">
		<p>Recently I had to write some article. There are several formats to write articles: one can use plain text, some use something like OOo Writer or MS Word, others use LaTeX, some XML fanatics use DocBook, etc. Personally I like writing texts in plain text format, especially using the ReST (ReStructured Text) markup, so the text document is very easy to read, including some basic formatting, and you can transform the text format to XHTML, LaTeX/PDF and several other formats using some simple tools provided by the DocUtils project.</p>

<p>As I'm using a plain text format, it's pretty useful to make use of some revision control system. And guess what, once again Git is a good choice ;-)</p>

<p>Now in this specific case, I got to have this article online too on my webserver. I got a bunch of public git repositories on that machine, including the one containing the article, but obviously this is not very useful as the HTML file rendered from the ReST source file should not be in Git.</p>

<p>So here's what I did: first I created a very basic Makefile which does the output file generation. Here it is:</p>
<pre><code>RSTOPTS=--time --strict --language=en
RSTHTMLOPTS=--embed-stylesheet

txt_SOURCES=myinputfile.txt
HTML=$(foreach t,$(filter %.txt,$(txt_SOURCES)),$(basename $(t)).html)
PDF=$(foreach t,$(filter %.txt,$(txt_SOURCES)),$(basename $(t)).pdf)
TMPS=$(foreach t,$(filter %.txt,$(txt_SOURCES)),$(basename $(t)).txt.tmp)

COMMIT_DATE=$(shell git-show | grep ^Date | sed "s/^Date: *//")
COMMIT_REV=$(shell git-show | grep ^commit | sed "s/^commit *//")

default: all

%.txt.tmp: %.txt
        @sed -e "s/@DATE@/$(COMMIT_DATE)/" -e "s/@REV@/$(COMMIT_REV)/" $^ > $@

%.html: %.txt.tmp
        rst2html.py $(RSTOPTS) $(RSTHTMLOPTS) $^ > $@

%.pdf: %.txt.tmp
        rst2latex.py $(RSTOPTS) $^ > $(basename $@).tex
        pdflatex $(basename $@).tex
        rm -f $(basename $@).log $(basename $@).out $(basename $@).tex $(basename $@).aux

html: $(HTML)
pdf: $(PDF)

all: html pdf

clean:
        rm -f $(HTML)
        rm -f $(PDF)
        rm -f $(TMPS)</code></pre>
<p>There are 3 variables on top you should/could edit: RSTOPTS which are the options passed to all rst2* tools, RSTHTMLOPTS which are the options passed to rst2html.py and txt_SOURCES, which is a simple list of all input files.</p>

<p>I also added functionality to add @DATE@ and @REV@ tags in your source files. These will be expanded to the commit date and commit/revision SHA1 sum of the tree you're working with. In ReST this is useful in the top part of your document where you define the author, contact address, version information, date,...</p>

<p>I committed this Makefile and my input ReST text file to some bare repository on my server (eg. /home/me/public_git/myarticle.git). Once this was done, I created a directory in my htdocs directory (let's call it "/home/me/public_html/myarticle"), chdir'ed into it, and made a clone of the repository: git-clone /home/me/public_git/myarticle.git</p>

<p>Now the Makefile and ReST file were in place, and I could run make html. After making a symlink to generate an index.html file which points to myarticle.html, it was available online.</p>

<p>Now one more feature had to be added: I want the public article HTML to be up-to-date with my repository, whenever I push new changes from my laptop to my server. This is very easy to achieve using git's hook script support. In /home/me/public_git/myarticle.git/hooks I created a file called post-update and ran chmod +x on it. Here's the content:</p>
<pre><code>CODIR="/home/me/public_html/myarticle"
export GIT_DIR=$CODIR/.git
pushd $CODIR > /dev/null
/usr/bin/git-pull > /dev/null 2>&amp;1
make html > /dev/null
popd > /dev/null

exec git-update-server-info</code></pre>

<p>Now whenever I run git-push myserver in my local tree, this script is executed. When it runs, the checkout I got inside my public_html directory is updated, and the HTML file is rerendered, so the last version is online.</p>

<p>Pretty useful!</p>			</div>
         <div class="bSmallPrint">
	  <a href="../../../ikke/2007/08/22/rest_git_hooks_useful.html" title="Permanent link to full entry" class="permalink_right"><img src="../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  12:00:15 am	  .

          645 Words          .
	  
	<a href="../../../ikke3f99.html?cat=16" title="true">Technology</a>  
	.
		.
	4137 views	
	 . <a href="../../../ikke/2007/08/22/rest_git_hooks_useful.html#comments" title="Display comments / Leave a comment">Leave a comment</a>	  	</div>
	</div>
<h2>08/15/07</h2><div class="bPost" lang="en-US">
		<div class="title">XKCD "Compiling"</div>
	<div class="bText">
		<p>Today's <a href="http://xkcd.com/">XKCD</a> is just hilareous:<br />
<a href="http://xkcd.com/303/"><img src="http://imgs.xkcd.com/comics/compiling.png" alt="" title="XKCD: Compiling" /></a></p>			</div>
         <div class="bSmallPrint">
	  <a href="../../../ikke/2007/08/15/xkcd_compiling.html" title="Permanent link to full entry" class="permalink_right"><img src="../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  11:59:39 am	  .

          5 Words          .
	  
	<a href="../../../ikke3f99.html?cat=16" title="true">Technology</a>  
	.
		.
	1714 views	
	 . <a href="../../../ikke/2007/08/15/xkcd_compiling.html#comments" title="Display comments / Leave a comment">Leave a comment</a>	  	</div>
	</div>
<div class="bPost" lang="en-US">
		<div class="title">ASUS laptops, multimedia keys and INPUT</div>
	<div class="bText">
		<p>For quite a while on several systems where ACPI is used to deliver key press events to the operating system (mostly laptops, that's why we got the asus_acpi, thinkpad, toshiba, sony,... drivers in the kernel). In userspace acpid was used then to fetch these commands, a callout script was used which used some application to inject the corresponding keycode (based on the ACPI event ID, which is just "randomly chosen" by the hardware manufacturers) on some input device, so applications (eg your X server) were able to see the key press events. Especially the acpid -> callout -> map scancode to keycode -> inject in input device isn't such a "nice" solution, but it worked, most of the time.</p>

<p>Recently people (one of them Richard Hughes of GPM fame, you know, that power-eating applet ;-)) started to rework these in-kernel drivers to use the kernel input subsystem directly, so no more round-trip to userspace would be necessary.<br />
There are 2 possibilities here: you can store a scancode to keycode mapping table in the driver itself, or you can remap scancodes to a keycode from userspace on some device using ioctl's.</p>

<p>This last method is made easy by HAL (0.5.10 or git), which includes a callout which allows you to store the mappings in an FDI file, and then performs the remapping when a matched device is found on the system. More information about this can be found <a href="http://people.freedesktop.org/~hughsient/quirk/quirk-keymap-index.html">here</a>.</p>

<p>IMHO this method is the cleanest, as it doesn't force us to store big device-specific mapping tables in the kernel driver. It's userspace so much easier to make changes, add new device information,...</p>

<p>ASUS laptop owners couldn't make use of this yet as nor the in-kernel driver, asus_laptop, or it's -cvs version provide relaying to a kernel input device. Yesterday I decided to implement this, and today it got somewhat finished, after some minor issues. You can find the resulting patch <a href="http://key.nicolast.be/files/asus_acpi_to_input.patch">here</a>, it's against current acpi4asus CVS, but I think it should apply cleanly against a vanilla kernel too. I'll submit it to the acpi4asus list tomorrow. Git repository is <a href="http://git.nicolast.be/?p=acpi4asus.git;a=summary">here</a>, you want the "acpi_keys_to_input_layer_no_internal_mapping" branch.</p>

<p>After compiling the driver and insmoding it (or modprobe if you install it too, make sure you don't load the old version by accident) you should see some information in dmesg: a message the driver is loaded, the name of your laptop model, and the fact a new input device called "Asus Extra Buttons" was created. Now when you press some multimedia buttons and check dmesg again, it should tell you some keys were pressed it can't map to a known keycode, also providing the scancode. You can use this information to generate an FDI file as described in the pages I linked to before.</p>

<p>If you're using an "old" HAL version, you can download a small utility <a href="http://git.nicolast.be/?p=acpi4asus.git;a=blob;f=samples/set-asus-keymap.c;h=f16345124c297beb6f11259fc0ff59267be5a93d;hb=acpi_keys_to_input_layer_no_internal_mapping">here</a> to emulate HAL's behaviour using hard-coded information. You need to make a list of scancodes and their meaning using KEY_* values. You can find these constants in /usr/include/linux/input.h, or in include/linux/input.h of your local kernel source tree.<br />
Once you know which scancodes map to which KEY_* value, you can add them to the "mappings" variable defined at the top of the C file. The format is simple: scancode1, keycode1, scancode2, keycode2,...,-1. Make sure you always add pairs of scancode/keycode values, and end the array with a -1.</p>

<p>Once you entered the values, compile the program (gcc -o set-asus-keymap set-asus-keymap.c), figure out the event device node for the Asus Extra Buttons device (check /proc/bus/input/devices, where Name is Asus Extra Buttons, see which eventX is after Handlers), and run the program (as root) using ./set-asus-keymap /dev/event/eventX (now I don't want *any* comments on this entry regarding "I have no eventX node").</p>

<p>When you're done with this, create a nice FDI file too, and send it to the HAL mailing list so others can enjoy your research too :-)</p>

<p>That's about it, your special keys should "just work" and acpid is no longer necessary to handle them.</p>			</div>
         <div class="bSmallPrint">
	  <a href="../../../ikke/2007/08/15/asus_laptops_multimedia_keys_and_input.html" title="Permanent link to full entry" class="permalink_right"><img src="../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  02:09:04 am	  .

          684 Words          .
	  
	<a href="../../../ikkec055.html?cat=17" title="true">Linux</a>, <a href="../../../ikke8e7f.html?cat=19" title="true">Desktop</a>, <a href="../../../ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	6329 views	
	 . <a href="../../../ikke/2007/08/15/asus_laptops_multimedia_keys_and_input.html#comments" title="Display comments / Leave a comment">7 comments</a>	  	</div>
	</div>
<h2>08/09/07</h2><div class="bPost" lang="en-US">
		<div class="title">An introduction to the git bisect feature</div>
	<div class="bText">
		<p>Recently <a href="http://git.or.cz/">git</a> is becoming a very popular revision control system for several projects. I tend to use it regularly too, both for my own projects, because it's used by a projects I hack on, or because I can get all powerful git features when working on a project which uses SVN as RCS (which is a good thing in some environments) through git-svn.</p>

<p>One of the very nice features of git is "bisect", which allows you to pin down the commit which broke code (or functionality) pretty easily. I used it eg. some days ago to figure out which commit in the "avivo" driver caused the driver to break on my system.</p>

<p>How does it work? Basicly, you clone a git repository, you start a bisect session, say "this commit did work", "this one doesnt work", and that's it. git will checkout a commit "in the middle" of the good and bad revisions, you compile/run/test the result, and tell git whether this version did work as expected or not. If it did work, git will checkout the revision between the current one (which was already at the middle between good and bad) and bad for you to test. If it did not work you'll get the revision in the middle of the "good" revision and the current one.<br />
Think about binary search, it's similar (actually, bisect *is* a binary search).</p>

<p>This way you're able to figure out which commit broke the app in a very short time (unless it crashes your system and it takes 3minutes to boot ;-)).</p>

<p>There is even more: if your application got a nice test suite consisting of unit test and alike, you're able to automate the whole process. The only thing you need is some script/tool/... which runs the test suites and returns a 0 exit code on success, or something else on failure. If you got this, git will do the whole bisect automagicly and tell you without any intervention what broke your application.</p>

<p>To demonstrate this I wrote a simple script. You can find it <a href="http://git.nicolast.be/?p=git-bisect-sample.git;a=tree">here</a> using gitweb, or git-clone <a href="http://git.nicolast.be/git-bisect-sample.git">http://git.nicolast.be/git-bisect-sample.git</a>.</p>

<p>Once you got the script on your system, you can test it. It takes 2 arguments: the number of commits to make, and which commit should break the application. The script will create a branch, then start creating a simple bash script. All this script does is assign 0 to i, increment i and decrement i. Every revision one increment and one decrement will be added. At the "bad" revision, one more increment will be added though. At the end i is used as return value.<br />
As you can see, before the bad revision the script will return 0, after it it will return 1, so it's a test suite on its own ;-)</p>

<p>Here's a sample run:</p>
<pre>$ sh createrepo.sh 20 16
Switched to a new branch "git_bisect_test"
Doing commit number 1
Created commit 9ce7f50f937b4e0e82c9c7fe143bb0483eb8e308
 1 files changed, 5 insertions(+), 0 deletions(-)
 create mode 100755 testcase.sh
Creating good_tag
Doing commit number 2
.....

Doing commit number 20
Created commit 0298fc50cb61eca005053a1c948f8651b2a346eb
 1 files changed, 2 insertions(+), 0 deletions(-)
Creating bad_tag</pre>
<p>So, it created a branch called "git_bisect_test" (just to keep our repository clean), did a first commit, tagged this as "good_tag" (we assume our first commit is a working application here. The good and bad revisions shouldn't be tagged, but this makes it easier for us further on). Then the script is created/updated and committed 20 times, breaking at the 16th commit. At the end, "bad_tag" is created. Once again, this is not necessary at all.</p>

<p>Now we found out our application is broken, so we'll bisect to figure out where it broke.</p>
<pre>$ git-bisect start
$ git-bisect good good_tag
$ git-bisect bad bad_tag 
Bisecting: 10 revisions left to test after this
[632c9c04b97578d674a2980648ee4ab748a8b147] commit number 11</pre>
<p>We're at "revision #11".</p>

<p>No the magic can start:</p>
<pre>$ git-bisect run ./testcase.sh
running ./testcase.sh
Bisecting: 5 revisions left to test after this
[d6514e8d9fe55827fe78d650548d948a4647fc50] commit number 16
running ./testcase.sh
Bisecting: 3 revisions left to test after this
[79e4ce719557e53c203789e1991f1ec00be823f7] commit number 14
running ./testcase.sh
Bisecting: 1 revisions left to test after this
[09f09d9a4e322a49b40de3f9d595f5132198c9b3] commit number 15
running ./testcase.sh
d6514e8d9fe55827fe78d650548d948a4647fc50 is first bad commit
commit d6514e8d9fe55827fe78d650548d948a4647fc50
Author: Nicolas Trangez &lt; &gt;
Date:   Thu Aug 9 23:43:48 2007 +0200

    commit number 16

:100755 100755 bd66b47cf24d9d3d00ac289395851d436b404774 ba01220423f64ea8b92a9df75c36a1a7ddda89ac M      testcase.sh
bisect run success</pre>

<p>Exactly, like it should, it figured out commit 16 (well, git got no commit numbers, this is just the commit message to keep things understandable easily) broke our application.</p>

<p>All we got to do now is stop the bisect process</p>
<pre>$ git-bisect reset</pre>
<p>and fix our application by looking up a diff of the bad revision.</p>

<p>In this sample case we should also clear the cruft the createrepo.sh script created:</p>
<pre>$ git-tag -d good_tag
$ git-tag -d bad_tag
$ git-checkout master
$ git-branch -D git_bisect_test</pre>

<p>That's it. More information can be found in the <a href="http://www.kernel.org/pub/software/scm/git/docs/user-manual.html">git manual</a> and in the <a href="http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html">git bisect manpage</a>.</p>			</div>
         <div class="bSmallPrint">
	  <a href="../../../ikke/2007/08/09/an_introduction_to_the_git_bisect_featur.html" title="Permanent link to full entry" class="permalink_right"><img src="../../../../skins/plain/images/chain_link.gif" alt="Permalink" width="14" height="14" border="0" class="middle" /></a>
	  .
          <a href="../../../all7441.html?author=" title="Browse all posts by this author">Ikke</a>

          .
	  11:28:32 pm	  .

          897 Words          .
	  
	<a href="../../../ikke3cd0.html?cat=49" title="true">Coding Corner</a>  
	.
		.
	2270 views	
	 . <a href="../../../ikke/2007/08/09/an_introduction_to_the_git_bisect_featur.html#comments" title="Display comments / Leave a comment">2 comments</a>	  	</div>
	</div>

<p class="center"><strong>
		</strong></p>

	
							
						
		  </div>
		
  </div>
  <br clear="all" />
  <div id="footer">
  <!-- This is the footer. Put all your copyright info here. -->
  <br />
  Design by <a href="http://www.jameskoster.co.uk/">James Koster</a>, Evoskin by <a href="http://www.brendoman.com/dbc">Danny Ferguson</a></div>
</center>
</body>

<!-- Mirrored from blog.eikke.com/index.php/all/2007/08/?blog=1&m=200708 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:27:16 GMT -->
</html>
