<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">


<!-- Mirrored from blog.eikke.com/index.php/ikke/2007/08/22/rest_git_hooks_useful by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:08:10 GMT -->
<head>
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title>Ikke's Blog - Post details: ReST + git + hooks = useful</title>
        <base  />        <meta name="description" content="Just my weBlog" />
        <meta name="keywords" content="nicolas trangez ikke eikke blog code linux desktop gnome dbus hal freedesktop ivman css xhtml code dump gallery c programming computing" />
        <meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
        <link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
        <link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
        <link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
        <link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
        <link rel="pingback" href="../../../../../xmlsrv/xmlrpc.php" />
  <link rel="stylesheet" type="text/css" href="../../../../../skins/nautica05-2col/css/layout.css" media="screen, projection, tv " />
  <link rel="stylesheet" type="text/css" href="../../../../../skins/nautica05-2col/css/html.css" media="screen, projection, tv " />

  <!-- CSS specific to current theme -->
  <link rel="stylesheet"           type="text/css" href="../../../../../skins/nautica05-2col/css/light.html" title="light" media="screen, projection, tv " />
  <link rel="alternate stylesheet" type="text/css" href="../../../../../skins/nautica05-2col/css/dark.html"  title="dark"  media="screen, projection, tv " />
        </head>

<body>

<!-- #content: holds all except site footer - causes footer to stick to bottom -->
<div id="content">

  <!-- #header: holds the logo and top links -->
  <div id="header" class="width">

    <img src="../../../../../skins/nautica05-2col/images/logo.gif" alt="Your logo goes here"/>
<ul id="bloglist"><li><a href="../../../../all.html" class="BlogButton" title="All Blogs">Blog All</a></li>
<li><a href="../../../../ikke.html" class="BlogButtonCurr" title="Ikke&#039;s Blog">Ikke</a></li>
<li><a href="../../../../fedorastateless.html" class="BlogButton" title="Fedora Stateless @ UGent">FSU</a></li>
<li><a href="../../../../realnitro.html" class="BlogButton" title="RealNitro&#039;s Blog">RealNitro</a></li>
<li><a href="http://peterdedecker.net/blog/index.php" class="BlogButton" title="Peter&#039;s Blog">Peter</a></li>
</ul>
    <!-- Or, comment out the bloglist and add your own links up here
    <ul>
      <li><a href="index.html">Back to Main page</a></li>
      <li><a href="">About us</a></li>
      <li><a href="">Streaming Video</a></li>
      <li><a href="" class="last">RSS Feeds</a></li>
    </ul>-->

  </div>
  <!-- #header end -->


  <!-- #headerImg: holds the main header image or flash -->
  <div id="headerImg" class="width"></div>



  <!-- #menu: the main large box site menu -->
  <div id="menu" class="width">
<!-- More links you could use if you want
    <ul>
      <li>
        <a href="onecol.html" onfocus="blur()">
          <span class="title ">One Column Layout</span>
          <span class="desc">View the included layout</span>        </a>      </li>
      <li>
        <a href="twocol_a.html" class="forum" onfocus="blur()">
          <span class="title ">Two Column Layout A</span>
          <span class="desc style3">View the included layout</span>        </a>      </li>
      <li>
        <a href="twocol_b.html" onfocus="blur()">
          <span class="title ">Two Column Layout B</span>
          <span class="desc">View the included layout</span>
        </a>
      </li>
      <li>
        <a href="contact.html" onfocus="blur()">
          <span class="title ">Contact Us Layout</span>
          <span class="desc">View the included layout</span>
        </a>
      </li>
    </ul>
    -->
  </div>
  <!-- #menu end -->



  <!-- #page: holds the page content -->
  <div id="page">


    <!-- #columns: holds the columns of the page -->
    <div id="columns" class="widthPad">


    <!-- Left column -->
    <div class="floatLeft width73">

<h1 style="margin-top:5px"><span class="dark"><a href="../../../../ikke.html">Ikke's Blog</a></span></h1>



<!-- =================================== START OF MAIN AREA =================================== -->

<div class="action_messages"></div>
<h2>Post details: ReST + git + hooks = useful</h2>
        <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Aug</span>
          <span class="day">22</span>
        </div>
<div class="bPost">
          <span class="title">ReST + git + hooks = useful</span>

                        <p>Recently I had to write some article. There are several formats to write articles: one can use plain text, some use something like OOo Writer or MS Word, others use LaTeX, some XML fanatics use DocBook, etc. Personally I like writing texts in plain text format, especially using the ReST (ReStructured Text) markup, so the text document is very easy to read, including some basic formatting, and you can transform the text format to XHTML, LaTeX/PDF and several other formats using some simple tools provided by the DocUtils project.</p>

<p>As I'm using a plain text format, it's pretty useful to make use of some revision control system. And guess what, once again Git is a good choice ;-)</p>

<p>Now in this specific case, I got to have this article online too on my webserver. I got a bunch of public git repositories on that machine, including the one containing the article, but obviously this is not very useful as the HTML file rendered from the ReST source file should not be in Git.</p>

<p>So here's what I did: first I created a very basic Makefile which does the output file generation. Here it is:</p>
<pre><code>RSTOPTS=--time --strict --language=en
RSTHTMLOPTS=--embed-stylesheet

txt_SOURCES=myinputfile.txt
HTML=$(foreach t,$(filter %.txt,$(txt_SOURCES)),$(basename $(t)).html)
PDF=$(foreach t,$(filter %.txt,$(txt_SOURCES)),$(basename $(t)).pdf)
TMPS=$(foreach t,$(filter %.txt,$(txt_SOURCES)),$(basename $(t)).txt.tmp)

COMMIT_DATE=$(shell git-show | grep ^Date | sed "s/^Date: *//")
COMMIT_REV=$(shell git-show | grep ^commit | sed "s/^commit *//")

default: all

%.txt.tmp: %.txt
        @sed -e "s/@DATE@/$(COMMIT_DATE)/" -e "s/@REV@/$(COMMIT_REV)/" $^ > $@

%.html: %.txt.tmp
        rst2html.py $(RSTOPTS) $(RSTHTMLOPTS) $^ > $@

%.pdf: %.txt.tmp
        rst2latex.py $(RSTOPTS) $^ > $(basename $@).tex
        pdflatex $(basename $@).tex
        rm -f $(basename $@).log $(basename $@).out $(basename $@).tex $(basename $@).aux

html: $(HTML)
pdf: $(PDF)

all: html pdf

clean:
        rm -f $(HTML)
        rm -f $(PDF)
        rm -f $(TMPS)</code></pre>
<p>There are 3 variables on top you should/could edit: RSTOPTS which are the options passed to all rst2* tools, RSTHTMLOPTS which are the options passed to rst2html.py and txt_SOURCES, which is a simple list of all input files.</p>

<p>I also added functionality to add @DATE@ and @REV@ tags in your source files. These will be expanded to the commit date and commit/revision SHA1 sum of the tree you're working with. In ReST this is useful in the top part of your document where you define the author, contact address, version information, date,...</p>

<p>I committed this Makefile and my input ReST text file to some bare repository on my server (eg. /home/me/public_git/myarticle.git). Once this was done, I created a directory in my htdocs directory (let's call it "/home/me/public_html/myarticle"), chdir'ed into it, and made a clone of the repository: git-clone /home/me/public_git/myarticle.git</p>

<p>Now the Makefile and ReST file were in place, and I could run make html. After making a symlink to generate an index.html file which points to myarticle.html, it was available online.</p>

<p>Now one more feature had to be added: I want the public article HTML to be up-to-date with my repository, whenever I push new changes from my laptop to my server. This is very easy to achieve using git's hook script support. In /home/me/public_git/myarticle.git/hooks I created a file called post-update and ran chmod +x on it. Here's the content:</p>
<pre><code>CODIR="/home/me/public_html/myarticle"
export GIT_DIR=$CODIR/.git
pushd $CODIR > /dev/null
/usr/bin/git-pull > /dev/null 2>&amp;1
make html > /dev/null
popd > /dev/null

exec git-update-server-info</code></pre>

<p>Now whenever I run git-push myserver in my local tree, this script is executed. When it runs, the checkout I got inside my public_html directory is updated, and the HTML file is rerendered, so the last version is online.</p>

<p>Pretty useful!</p>                              <!-- End Post -->
                  <div><script type="text/javascript"><!--
      google_ad_client = "pub-7170970013053423";
      //blog.eikke.com links
      google_ad_slot = "9622796794";
      google_ad_width = 468;
      google_ad_height = 15;
      //--></script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script></div>
                      <div class="bSmallPrint">
                        Ikke &bull; <strong><a href="../../../../ikke3f99.html?cat=16" title="Browse category">Technology</a></strong><a href="rest_git_hooks_useful.html" title="Permanent link to full entry" class="permalink_right"><img src="../../../../../rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="rest_git_hooks_useful.html#comments" title="Display comments / Leave a comment">Leave a comment</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2007/08/22/rest_git_hooks_useful"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2007/08/22/rest_git_hooks_useful"
  dc:title="ReST + git + hooks = useful"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/505" />
</rdf:RDF>-->
                </div>
</div>
                <a name="feedbacks"></a><a name="comments"></a>
	<!-- Title for comments, tbs, pbs... -->
	<h4>Comments:</h4>

	<div class="bComment"><p>No Comments for this post yet...</p></div><div class="moderation_msg"><p>This post has 3 feedbacks awaiting moderation... </p></div>		<h4 class="bCommentLeaveHead">Leave a comment:</h4>

		<!-- form to add a comment -->
		

<form name="bComment_form_id_505" id="bComment_form_id_505" class="bComment" method="post" action="http://blog.eikke.com/htsrv/comment_post.php">
<span style="float:right"></span>
<script type="text/javascript">
							var nb_dynamicSelects = 0;
							var tab_dynamicSelects = Array();
						</script><fieldset>
<div class="label"><label for="u">Name:</label></div>
<div class="input"><input maxlength="100" class="bComment" size="40" type="text" name="u" id="u" />
</div>
</fieldset>

<fieldset>
<div class="label"><label for="i">Email:</label></div>
<div class="input"><input maxlength="100" class="bComment" size="40" type="text" name="i" id="i" />
 <span class="notes">Your email address will <strong>not</strong> be displayed on this site.</span></div>
</fieldset>

<fieldset>
<div class="label"><label for="o">Site/Url:</label></div>
<div class="input"><input maxlength="100" class="bComment" size="40" type="text" name="o" id="o" />
 <span class="notes">Your URL will be displayed.</span></div>
</fieldset>

<fieldset>
<div class="label"><label for="p">Comment text:</label></div>
<div class="input"><img src="../../../../../rsc/img/blank.gif" width="1" height="1" alt="" /><textarea cols="40" class="bComment" name="p" id="p" rows="10"></textarea><img src="../../../../../rsc/img/blank.gif" width="1" height="1" alt="" /><br/><span class="notes">Allowed XHTML tags: &lt;p, ul, ol, li, dl, dt, dd, address, blockquote, ins, del, span, bdo, br, em, strong, dfn, code, samp, kdb, var, cite, abbr, acronym, q, sub, sup, tt, i, b, big, small&gt;</span></div>
</fieldset>

<fieldset class="fieldset">
<fieldset>
<div class="label"><label>Options:</label></div>
<div class="input"><input tabindex="6" name="comment_autobr" type="checkbox" value="1" checked="checked" class="checkbox" id="comment_autobr" />
<label for="comment_autobr">Auto-BR</label>
 <span class="notes">(Line breaks become &lt;br /&gt;)</span>

<br /><input tabindex="7" name="comment_cookies" type="checkbox" value="1" checked="checked" class="checkbox" id="comment_cookies" />
<label for="comment_cookies">Remember me</label>
 <span class="notes">(Set cookies for name, email and url)</span>

<br /><input tabindex="8" name="comment_allow_msgform" type="checkbox" value="1" checked="checked" class="checkbox" id="comment_allow_msgform" />
<label for="comment_allow_msgform">Allow message form</label>
 <span class="notes">(Allow users to contact you through a message form (your email will NOT be displayed.))</span>

</div>
</fieldset>

</fieldset>
<fieldset class="fieldset">
<div class="input">			<input name="submit_comment_post_505[save]" class="submit" value="Send comment" tabindex="10" type="submit" />
			<input name="submit_comment_post_505[preview]" class="preview" value="Preview" tabindex="9" type="submit" />
</div></fieldset>

		<div class="clear"></div>

		<input name="comment_post_ID" type="hidden" value="505" />
<input name="redirect_to" type="hidden" value="http://blog.eikke.com/index.php/ikke?blog=5&amp;amp;title=rest_git_hooks_useful&amp;amp;page=1&amp;amp;more=1&amp;amp;c=1&amp;amp;tb=1&amp;amp;pb=1&amp;amp;disp=single" />

</form>

<script type="text/javascript">
							if( typeof addEvent == "function" && typeof init_dynamicSelect == "function" )
							{
								addEvent( window, "load", init_dynamicSelect, false );
								
							}
						</script>        </div>
      </div>
        
        <p class="center"><strong>
                                 </strong></p>

    </div>
    <!-- Left column end -->


    <!-- Right link column -->
    <div class="floatRight width25 lightBlueBg horzPad">
               <div class="bSideItem">
                <form action="http://blog.eikke.com/index.php/ikke" method="get" name="SearchForm" class="search">                        <p><input type="text" name="s" size="23" value="" class="SearchField" /><br />
                        <input type="submit" name="submit" class="submit" value="Search" style="margin-top:3px" /></p>
                </form>
        </div>
		<div class="bSideItem">
	<div style='position: relative; left: 25px;'>
	<script type="text/javascript"><!--
	google_ad_client = "pub-7170970013053423";
	//Ikke&#39;s blog
	google_ad_slot = "5340725895";
	google_ad_width = 120;
	google_ad_height = 240;
	//--></script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script></div>
		</div>
              <div class="catarc"><h3>Categories</h3><ul><li><a href="../../../../ikke.html">All</a></li>
<li><a href="../../../../ikkeb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="../../../../ikke3f99.html?cat=16">Technology</a> <span class="notes">(131)</span><ul><li><a href="../../../../ikke3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span><ul><li><a href="../../../../ikkebff0.html?cat=52">Docbook</a> <span class="notes">(7)</span></li>
<li><a href="../../../../ikkee864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span></li>
</ul>
</li>
<li><a href="../../../../ikke8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span></li>
<li><a href="../../../../ikke7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span></li>
<li><a href="../../../../ikkec055.html?cat=17">Linux</a> <span class="notes">(90)</span></li>
<li><a href="../../../../ikke6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span></li>
</ul>
</li>
</ul>
</div>

        <div class="catarc"><h3>Archives</h3><ul><li><a href="../../12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../../10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="../../05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="../../03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="../../02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="../../01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="../../../2006/07/index.html">July 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="../../../2006/06/index.html">June 2006</a> <span class="dimmed">(3)</span></li>
<li><a href="../../../../ikke1579.html?disp=arcdir">More...</a></li>
</ul>
</div>


	                <div class="catarc">
                <h3 class="sideItemTitle">Who's Online?</h3>
                <ul class="onlineUsers"><li>Guest Users: 133</li></ul>        </div>
        
        <div class="bSideItem">
                <h3>Misc</h3>
                <ul>
                        <li><a href="../../../../../htsrv/login3961.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fikke%2F2007%2F08%2F22%2Frest_git_hooks_useful%3Fblog%3D5%26amp%3Btitle%3Drest_git_hooks_useful%26amp%3Bpage%3D1%26amp%3Bmore%3D1%26amp%3Bc%3D1%26amp%3Btb%3D1%26amp%3Bpb%3D1%26amp%3Bdisp%3Dsingle" title="Login if you have an account...">Login...</a></li>                </ul>
        </div>
        <div class="bSideItem">
                <h3><img src="../../../../../rsc/icons/feed-icon-16x16.gif" width="16" height="16" class="top" alt="" /> XML Feeds</h3>
                        <ul>
                                <li>
                                        RSS 0.92:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="../../../../ikke7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        RSS 1.0:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="../../../../ikke374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        RSS 2.0:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="../../../../ikke6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        Atom:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="../../../../ikke5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
                                </li>
                        </ul>
                        <a href="http://fplanque.net/Blog/itTrends/2004/01/10/rss_rdf_and_atom_in_a_nutshell" title="External - English">What is RSS?</a>
			<div class='bSideItem'><div style='width: 120px; height: 600px; position: relative; left: 25px; padding-bottom: 10px;'>
			<script type="text/javascript"><!--
			google_ad_client = "pub-7170970013053423";
			//blog.eikke.com sidebar onderaan
			google_ad_slot = "7138271274";
			google_ad_width = 120;
			google_ad_height = 600;
			//--></script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
			</div></div>        </div>


        


    </div>
    <!-- Right links column end -->



    </div>
    <!-- #columns end -->

  </div>
  <!-- #page end -->

</div>
<!-- #content end -->




<!-- #footer: holds the site footer (logo and links) -->
<div id="footer">

  <!-- #bg: applies the site width and footer background -->
  <div id="bg" class="width">

    <img src="../../../../../skins/nautica05-2col/images/logo.gif" alt="Your logo goes here"/>

    <ul>
      <li><a href="http://b2evolution.net/" title="Powered by b2evolution">b<sub>2</sub>evolution</a></li>
      <li><a href="http://www.brendoman.com/dbc" title="Evoskin by Danny Ferguson">Danny Ferguson</a></li>
      <li><a href="http://www.studio7designs.com/" title="Design by Studio 7 Designs" class="last">studio7designs.com</a></li>
	</ul>

  </div>
  <!-- #bg end -->

</div>
<!-- #footer end -->
</body>


<!-- Mirrored from blog.eikke.com/index.php/ikke/2007/08/22/rest_git_hooks_useful by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 19:08:11 GMT -->
</html>
