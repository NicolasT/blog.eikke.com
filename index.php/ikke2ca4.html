<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">


<!-- Mirrored from blog.eikke.com/index.php/ikke?blog=5&cat=16&page=1&paged=27 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 20:02:35 GMT -->
<head>
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title>Ikke's Blog - Categories: Technology, Coding Corner, Docbook, Summer of Code 06, Desktop, Ivman, Linux, Networks</title>
        <base  />        <meta name="description" content="Just my weBlog" />
        <meta name="keywords" content="nicolas trangez ikke eikke blog code linux desktop gnome dbus hal freedesktop ivman css xhtml code dump gallery c programming computing" />
        <meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
        <link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
        <link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
        <link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
        <link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
        <link rel="pingback" href="../xmlsrv/xmlrpc.php" />
  <link rel="stylesheet" type="text/css" href="../skins/nautica05-2col/css/layout.css" media="screen, projection, tv " />
  <link rel="stylesheet" type="text/css" href="../skins/nautica05-2col/css/html.css" media="screen, projection, tv " />

  <!-- CSS specific to current theme -->
  <link rel="stylesheet"           type="text/css" href="../skins/nautica05-2col/css/light.html" title="light" media="screen, projection, tv " />
  <link rel="alternate stylesheet" type="text/css" href="../skins/nautica05-2col/css/dark.html"  title="dark"  media="screen, projection, tv " />
        </head>

<body>

<!-- #content: holds all except site footer - causes footer to stick to bottom -->
<div id="content">

  <!-- #header: holds the logo and top links -->
  <div id="header" class="width">

    <img src="../skins/nautica05-2col/images/logo.gif" alt="Your logo goes here"/>
<ul id="bloglist"><li><a href="all.html" class="BlogButton" title="All Blogs">Blog All</a></li>
<li><a href="ikke.html" class="BlogButtonCurr" title="Ikke&#039;s Blog">Ikke</a></li>
<li><a href="fedorastateless.html" class="BlogButton" title="Fedora Stateless @ UGent">FSU</a></li>
<li><a href="realnitro.html" class="BlogButton" title="RealNitro&#039;s Blog">RealNitro</a></li>
<li><a href="http://peterdedecker.net/blog/index.php" class="BlogButton" title="Peter&#039;s Blog">Peter</a></li>
</ul>
    <!-- Or, comment out the bloglist and add your own links up here
    <ul>
      <li><a href="index.html">Back to Main page</a></li>
      <li><a href="">About us</a></li>
      <li><a href="">Streaming Video</a></li>
      <li><a href="" class="last">RSS Feeds</a></li>
    </ul>-->

  </div>
  <!-- #header end -->


  <!-- #headerImg: holds the main header image or flash -->
  <div id="headerImg" class="width"></div>



  <!-- #menu: the main large box site menu -->
  <div id="menu" class="width">
<!-- More links you could use if you want
    <ul>
      <li>
        <a href="onecol.html" onfocus="blur()">
          <span class="title ">One Column Layout</span>
          <span class="desc">View the included layout</span>        </a>      </li>
      <li>
        <a href="twocol_a.html" class="forum" onfocus="blur()">
          <span class="title ">Two Column Layout A</span>
          <span class="desc style3">View the included layout</span>        </a>      </li>
      <li>
        <a href="twocol_b.html" onfocus="blur()">
          <span class="title ">Two Column Layout B</span>
          <span class="desc">View the included layout</span>
        </a>
      </li>
      <li>
        <a href="contact.html" onfocus="blur()">
          <span class="title ">Contact Us Layout</span>
          <span class="desc">View the included layout</span>
        </a>
      </li>
    </ul>
    -->
  </div>
  <!-- #menu end -->



  <!-- #page: holds the page content -->
  <div id="page">


    <!-- #columns: holds the columns of the page -->
    <div id="columns" class="widthPad">


    <!-- Left column -->
    <div class="floatLeft width73">

<h1 style="margin-top:5px"><span class="dark"><a href="ikke.html">Ikke's Blog</a></span></h1>



<!-- =================================== START OF MAIN AREA =================================== -->

<div class="action_messages"></div>
<h2>Categories: Technology, Coding Corner, Docbook, Summer of Code 06, Desktop, Ivman, Linux, Networks</h2>
        <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Dec</span>
          <span class="day">2</span>
        </div>
<div class="bPost">
          <span class="title">Let PHP write code for you</span>

                        <p>I'm working on a project. A neat new server. Well, the server itself (you know, that PowerEdge 2400 I talked about yesterday) seems to be, well, screwed somehow, but I wanted to *do* somethin anyway.</p>

<p>The magic word is LDAP. We want everything into an LDAP directory where possible. System users, quota, email aliases, Horde preferences, mailing list members, Samba as a PDC using LDAP as userbase/password backend, everything. I was able to set all of this up on my workstation, so that won't be a big problem.</p>

<p>There is one major issue tough: frontends. We were not able to find any decent frontend suited to our needs. Of course there is <a href="http://phpldapadmin.sf.net/">PhpLdapAdmin</a>, which is a great tool to browse your tree and edit base-level stuff, but it's only usefull for directory administrators. You cannot expect a normal user to use PLA to change his password.</p>

<p>So we have to write everything ourself. Because we'd like to give the user both webbased and CLI interfaces for all administration tasks, <a href="http://www.php.net/">PHP</a> was chosen as development platform, using <a href="http://pear.php.net/">PEAR's</a> <a href="http://pear.php.net/package/Net_LDAP">Net_LDAP</a> modules, which is kinda neat. You can use it to retrieve <a href="http://cvs.php.net/co.php/pear/Net_LDAP/doc/Schema.txt?r=1.3">LDAP Schema information</a>, which is what I need here.</p>

<p>The objective is simple: create classes in PHP that represent an LDAP objectClass. So if a user in LDAP is an "inetOrgPerson", I need a class in PHP called "inetOrgPerson", like <code>$ikke = new inetOrgPerson( "uid=ikke,dc=test,dc=com");</code></p>

<p>Because LDAP supports objectClass inheritance, this should be reflected in the PHP code too. LDAP supports multiple inheritance, a PHP class can only inherit from one class, but normally this isn't a big issue, because most objectClasses only SUP one parent objectClass.</p>

<p>Writing PHP files with classes representing all possible attibuteTypes and objectClasses by hand didn't look like a pleasant foresight to me, so I wanted to automate things. Of course I could write everything by hand once, but then if new schema's would be added to the LDAP server, I'd have to write more classes, change inheritance,... which is just plain stupid.</p>

<p>So I started to write PHP classes and functions that create PHP class files for me, based on data it retrieves from the LDAP server. At the moment, attributeTypes and objectClasses are only represented using member variables and (read) accessor functions, so something like the example I gave is not possible (yet), but it shouldn't be too hard to get that working too.</p>

<p>This is what it looks like now:</p>
<pre>
* schemaItem
        * atributeType inherits schemaItem
                * homeDirectory inherits attributeType
                * uid inherits attributeType
                * ...
        (attributeType inheritance isn't supported)
        * objectClass inherits schemaItem
                * top inherits objectClass
                        * person inherits top
                                * organisationalPerson inherits person
                                        * inetOrgPerson inherits organisationalPerson
                                * ...
                        * ...
</pre>
<p>Every attributeType is represented by (attributeTypeName).class.php in a certain directory, and every objectClass as (objectClassName).class.php in some other directory.</p>

<p>Some classes provide the factory methods to create these class files: there is the base classBuilder class, which provides the following functions:</p>
<pre>- classBuilder( $name, $super = null )
     Constructor. $name is the name of the class to "build", $super is an optional base class $name should extend.
- addRequire( $req )
     Add a "require_once( $req )" to the output file.
- addVariable( $type, $name, $private = false )
     Add a member variable of type $type (mentioned in a comment), with name $name, to the class.
     $private is not used yet, but could be used in the future to force prefixing private variables using an
     _underscore_
- addVariableValue( $type, $name, $value, $vartype = VARIABLE_TYPE_STRING, $private = false )
     Add a member variable which has a predefined value. $type, $name and $private are the same things as in
     addVariable(3). $value is the standard value this variable should have, and $vartype defines the
     type of the variable: STRING, INT or BOOL, so strings can be written like 'var $test = "test"',
     integers like 'var $test = 1', and booleans like 'var $test = true' (watch the quotes).
- writeFile( $filename )
     Finally writes the class structure to file $filename.</pre>

<p>Next to these there are some more private functions, like one to generate a PHP-syntax-compatible representation of an Array (also multi-dimensional arrays because the function can call itself, I think it's pretty nifty :)) )</p>

<p>As you can see it is not possible to add member functions to classes, which should not be necessary, because the base classes ("schemaItem", "attributeType" and "objectClass") provide the necessay ones.</p>

<p>Next, I got Writer classes for every type I got:</p>
<pre>* schemaItemWriter inheits classBuilder
        * attributeTypeWriter inherits schemaItemWriter
        * objectClassWriter inherits schemaItemWriter</pre>
<p>These classes take data from the LDAP server to give classBuilder all the information it needs to generate the class files for all objects.</p>

<p>This could sound very obscure, but actually it isn't. I have to admit the code is not documented tough :oops: The PhpDoc tags are there (thank you <a href="http://www.vim.org/">Vim</a> and the <a href="http://www.vim.org/scripts/script.php?script_id=520">Vim PHPDoc plugin</a>), but the correct data isn't in there ;)</p>

<p>Now the results:</p>
<pre>cat attributeTypes/email.class.php
&lt;?php

require_once( "attributeType.class.php" );

class email extends attributeType {
        //Type: String
        var $_oid = "1.2.840.113549.1.9.1";
        //Type: String
        var $_name = "email";
        //Type: String
        var $_equality = "caseIgnoreIA5Match";
        //Type: String
        var $_substring = "caseIgnoreIA5SubstringsMatch";
        //Type: String
        var $_syntax = "1.3.6.1.4.1.1466.115.121.1.26{128}";
        //Type: Integer
        var $_maxLength = 128;
        //Type: Array
        var $_aliases = array("0" => "emailAddress","1" => "pkcs9email");

}

?&gt;
</pre>
<pre>cat objectClasses/top.class.php objectClasses/person.class.php
&lt;?php

require_once( "objectClass.class.php" );

class top extends objectClass {
        //Type: String
        var $_oid = "2.5.6.0";
        //Type: String
        var $_name = "top";
        //Type: objectClass (Must)
        var $objectClass;

}

?&gt;
&lt;?php

require_once( "top.class.php" );

class person extends top {
        //Type: String
        var $_oid = "2.5.6.6";
        //Type: String
        var $_name = "person";
        //Type: Array
        var $_supClasses = array("0" => "top");
        //Type: sn (Must)
        var $sn;
        //Type: cn (Must)
        var $cn;
        //Type: userPassword (May)
        var $userPassword;
        //Type: telephoneNumber (May)
        var $telephoneNumber;
        //Type: seeAlso (May)
        var $seeAlso;
        //Type: description (May)
        var $description;
        //Type: Bool
        var $_structural = true;

}

?&gt;
</pre>
<pre>ls attributeTypes objectClasses | wc -l
224</pre><p>Generating these files manually would be a PITA ;-)</p>

<p>As you can see this code is not ready (yet): for the objectClasses, there should be validator functions (are all Must attributes set?), accessor functions for all attributes, and last but not least, pulling and pushing data from/to the LDAP directory...</p>

<p>I'm very happy with the current results. Once all schema information is pulled from the server by Net_LDAP, the parsing of this data and creation of class files is very fast. Adding the other necessary functions should be a breeze (well, not really ;-)) now.</p>

<p>Once this is done, we need to write some simple backend for everything (an abstraction layer between the frontends and the actual objectClasses etc, something the user nor the frontend scripter should be aware of), and of course the frontends. PEAR <a href="http://pear.php.net/package/Console_Getopt">Console_Getopt</a> looks usefull :-)</p>


<p>I'm at university at the moment: there is a LanWar night going on (I'm not gaming, but well...).</p>                              <!-- End Post -->
                  <div><script type="text/javascript"><!--
      google_ad_client = "pub-7170970013053423";
      //blog.eikke.com links
      google_ad_slot = "9622796794";
      google_ad_width = 468;
      google_ad_height = 15;
      //--></script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script></div>
                      <div class="bSmallPrint">
                        Ikke &bull; <strong><a href="ikke3f99.html?cat=16" title="Browse category">Technology</a></strong><a href="ikke/2004/12/02/let_php_write_code_for_you.html" title="Permanent link to full entry" class="permalink_right"><img src="../rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="ikke/2004/12/02/let_php_write_code_for_you.html#comments" title="Display comments / Leave a comment">3 comments</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2004/12/02/let_php_write_code_for_you"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2004/12/02/let_php_write_code_for_you"
  dc:title="Let PHP write code for you"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/23" />
</rdf:RDF>-->
                </div>
</div>
                        </div>
      </div>
        
        <p class="center"><strong>
                <a href="ikke34a5.html?blog=5&amp;cat=16&amp;page=1&amp;paged=26">&lt;&lt; Previous Page</a> ::                  </strong></p>

    </div>
    <!-- Left column end -->


    <!-- Right link column -->
    <div class="floatRight width25 lightBlueBg horzPad">
               <div class="bSideItem">
                <form action="http://blog.eikke.com/index.php/ikke" method="get" name="SearchForm" class="search">                        <p><input type="text" name="s" size="23" value="" class="SearchField" /><br />
                        <input type="submit" name="submit" class="submit" value="Search" style="margin-top:3px" /></p>
                </form>
        </div>
		<div class="bSideItem">
	<div style='position: relative; left: 25px;'>
	<script type="text/javascript"><!--
	google_ad_client = "pub-7170970013053423";
	//Ikke&#39;s blog
	google_ad_slot = "5340725895";
	google_ad_width = 120;
	google_ad_height = 240;
	//--></script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script></div>
		</div>
              <div class="catarc"><h3>Categories</h3><ul><li><a href="ikke.html">All</a></li>
<li><a href="ikkeb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="ikke3f99.html?cat=16">Technology</a> <span class="notes">(131)</span>*<ul><li><a href="ikke3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span>*<ul><li><a href="ikkebff0.html?cat=52">Docbook</a> <span class="notes">(7)</span>*</li>
<li><a href="ikkee864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span>*</li>
</ul>
</li>
<li><a href="ikke8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span>*</li>
<li><a href="ikke7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span>*</li>
<li><a href="ikkec055.html?cat=17">Linux</a> <span class="notes">(90)</span>*</li>
<li><a href="ikke6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span>*</li>
</ul>
</li>
</ul>
</div>

        <div class="catarc"><h3>Archives</h3><ul><li><a href="ikke/2007/12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="ikke/2007/11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="ikke/2007/10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="ikke/2007/09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="ikke/2007/08/index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="ikke/2007/05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="ikke/2007/04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="ikke/2007/03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="ikke/2007/02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="ikke/2007/01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="ikke/2006/07/index.html">July 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="ikke/2006/06/index.html">June 2006</a> <span class="dimmed">(3)</span></li>
<li><a href="ikke1579.html?disp=arcdir">More...</a></li>
</ul>
</div>


	                <div class="catarc">
                <h3 class="sideItemTitle">Who's Online?</h3>
                <ul class="onlineUsers"><li>Guest Users: 524</li></ul>        </div>
        
        <div class="bSideItem">
                <h3>Misc</h3>
                <ul>
                        <li><a href="../htsrv/loginef81.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%2Fikke%3Fblog%3D5%26amp%3Bcat%3D16%26amp%3Bpaged%3D27%26amp%3Bpage%3D1" title="Login if you have an account...">Login...</a></li>                </ul>
        </div>
        <div class="bSideItem">
                <h3><img src="../rsc/icons/feed-icon-16x16.gif" width="16" height="16" class="top" alt="" /> XML Feeds</h3>
                        <ul>
                                <li>
                                        RSS 0.92:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="ikke7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        RSS 1.0:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="ikke374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        RSS 2.0:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="ikke6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        Atom:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="ikke5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
                                </li>
                        </ul>
                        <a href="http://fplanque.net/Blog/itTrends/2004/01/10/rss_rdf_and_atom_in_a_nutshell" title="External - English">What is RSS?</a>
			<div class='bSideItem'><div style='width: 120px; height: 600px; position: relative; left: 25px; padding-bottom: 10px;'>
			<script type="text/javascript"><!--
			google_ad_client = "pub-7170970013053423";
			//blog.eikke.com sidebar onderaan
			google_ad_slot = "7138271274";
			google_ad_width = 120;
			google_ad_height = 600;
			//--></script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
			</div></div>        </div>


        


    </div>
    <!-- Right links column end -->



    </div>
    <!-- #columns end -->

  </div>
  <!-- #page end -->

</div>
<!-- #content end -->




<!-- #footer: holds the site footer (logo and links) -->
<div id="footer">

  <!-- #bg: applies the site width and footer background -->
  <div id="bg" class="width">

    <img src="../skins/nautica05-2col/images/logo.gif" alt="Your logo goes here"/>

    <ul>
      <li><a href="http://b2evolution.net/" title="Powered by b2evolution">b<sub>2</sub>evolution</a></li>
      <li><a href="http://www.brendoman.com/dbc" title="Evoskin by Danny Ferguson">Danny Ferguson</a></li>
      <li><a href="http://www.studio7designs.com/" title="Design by Studio 7 Designs" class="last">studio7designs.com</a></li>
	</ul>

  </div>
  <!-- #bg end -->

</div>
<!-- #footer end -->
</body>


<!-- Mirrored from blog.eikke.com/index.php/ikke?blog=5&cat=16&page=1&paged=27 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 20:02:36 GMT -->
</html>
