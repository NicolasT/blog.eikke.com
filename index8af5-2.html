<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">


<!-- Mirrored from blog.eikke.com/index.php?blog=5&page=1&paged=34 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 20:04:19 GMT -->
<head>
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title>Ikke's Blog</title>
        <base  />        <meta name="description" content="Just my weBlog" />
        <meta name="keywords" content="nicolas trangez ikke eikke blog code linux desktop gnome dbus hal freedesktop ivman css xhtml code dump gallery c programming computing" />
        <meta name="generator" content="b2evolution 1.8.6" /> <!-- Please leave this for stats -->
        <link rel="alternate" type="text/xml" title="RDF" href="http://eikke.com/feed/" />
        <link rel="alternate" type="text/xml" title="RSS .92" href="http://eikke.com/feed/" />
        <link rel="alternate" type="text/xml" title="RSS 2.0" href="http://eikke.com/feed/" />
        <link rel="alternate" type="application/atom+xml" title="Atom" href="http://eikke.com/feed/" />
        <link rel="pingback" href="xmlsrv/xmlrpc.php" />
  <link rel="stylesheet" type="text/css" href="skins/nautica05-2col/css/layout.css" media="screen, projection, tv " />
  <link rel="stylesheet" type="text/css" href="skins/nautica05-2col/css/html.css" media="screen, projection, tv " />

  <!-- CSS specific to current theme -->
  <link rel="stylesheet"           type="text/css" href="skins/nautica05-2col/css/light.html" title="light" media="screen, projection, tv " />
  <link rel="alternate stylesheet" type="text/css" href="skins/nautica05-2col/css/dark.html"  title="dark"  media="screen, projection, tv " />
        </head>

<body>

<!-- #content: holds all except site footer - causes footer to stick to bottom -->
<div id="content">

  <!-- #header: holds the logo and top links -->
  <div id="header" class="width">

    <img src="skins/nautica05-2col/images/logo.gif" alt="Your logo goes here"/>
<ul id="bloglist"><li><a href="index.php/all.html" class="BlogButton" title="All Blogs">Blog All</a></li>
<li><a href="index.php/ikke.html" class="BlogButtonCurr" title="Ikke&#039;s Blog">Ikke</a></li>
<li><a href="index.php/fedorastateless.html" class="BlogButton" title="Fedora Stateless @ UGent">FSU</a></li>
<li><a href="index.php/realnitro.html" class="BlogButton" title="RealNitro&#039;s Blog">RealNitro</a></li>
<li><a href="http://peterdedecker.net/blog/index.php" class="BlogButton" title="Peter&#039;s Blog">Peter</a></li>
</ul>
    <!-- Or, comment out the bloglist and add your own links up here
    <ul>
      <li><a href="index.html">Back to Main page</a></li>
      <li><a href="">About us</a></li>
      <li><a href="">Streaming Video</a></li>
      <li><a href="" class="last">RSS Feeds</a></li>
    </ul>-->

  </div>
  <!-- #header end -->


  <!-- #headerImg: holds the main header image or flash -->
  <div id="headerImg" class="width"></div>



  <!-- #menu: the main large box site menu -->
  <div id="menu" class="width">
<!-- More links you could use if you want
    <ul>
      <li>
        <a href="onecol.html" onfocus="blur()">
          <span class="title ">One Column Layout</span>
          <span class="desc">View the included layout</span>        </a>      </li>
      <li>
        <a href="twocol_a.html" class="forum" onfocus="blur()">
          <span class="title ">Two Column Layout A</span>
          <span class="desc style3">View the included layout</span>        </a>      </li>
      <li>
        <a href="twocol_b.html" onfocus="blur()">
          <span class="title ">Two Column Layout B</span>
          <span class="desc">View the included layout</span>
        </a>
      </li>
      <li>
        <a href="contact.html" onfocus="blur()">
          <span class="title ">Contact Us Layout</span>
          <span class="desc">View the included layout</span>
        </a>
      </li>
    </ul>
    -->
  </div>
  <!-- #menu end -->



  <!-- #page: holds the page content -->
  <div id="page">


    <!-- #columns: holds the columns of the page -->
    <div id="columns" class="widthPad">


    <!-- Left column -->
    <div class="floatLeft width73">

<h1 style="margin-top:5px"><span class="dark"><a href="index.php/ikke.html">Ikke's Blog</a></span></h1>



<!-- =================================== START OF MAIN AREA =================================== -->

<div class="action_messages"></div>

        <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Feb</span>
          <span class="day">6</span>
        </div>
<div class="bPost">
          <span class="title"><a href="http://www.eikke.com/articles/glib-mainloop.html">New article: The Glib Mainloop</a></span>

                        <p>I decided to write new articles in docbook directly, not posting them into this blog.</p>

<p>As promised I wrote an article on the <a href="http://developer.gnome.org/doc/API/2.0/glib/glib-The-Main-Event-Loop.html" title="Glib Mainloop">Glib Mainloop</a>. It is available <a href="http://www.eikke.com/articles/glib-mainloop.html" title="here">here</a>. I still need to add hyperlinks to the quoted references (API's,...), but I'll do that later.</p>

<p>I start to like DocBook, actually. The generated documents may look ugly, but some CSS work could fix it.<br />
The good thing is you got a consistent interface, and the XML you write really describes what you're writing about, if you use the correct tags.<br />
The documents I write may not be 100% correct (missing tags on some places etc), but I'm learning ;-)</p>

<p>I hope you like the article, please comment on it if thing's aren't correct, not obvious enough,...</p>

<p>I should try to write up some CV too next days. Hell of a job.</p>                              <!-- End Post -->
                  <div><script type="text/javascript"><!--
      google_ad_client = "pub-7170970013053423";
      //blog.eikke.com links
      google_ad_slot = "9622796794";
      google_ad_width = 468;
      google_ad_height = 15;
      //--></script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script></div>
                      <div class="bSmallPrint">
                        Ikke &bull; <a href="index.php/ikkeb5e7.html?cat=15" title="Browse category">Life</a>, <strong><a href="index.php/ikke3cd0.html?cat=49" title="Browse category">Coding Corner</a></strong><a href="index.php/ikke/2005/02/06/new_article_the_glib_mainloop.html" title="Permanent link to full entry" class="permalink_right"><img src="rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="index.php/ikke/2005/02/06/new_article_the_glib_mainloop.html#comments" title="Display comments / Leave a comment">Leave a comment</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2005/02/06/new_article_the_glib_mainloop"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2005/02/06/new_article_the_glib_mainloop"
  dc:title="New article: The Glib Mainloop"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/104" />
</rdf:RDF>-->
                </div>
</div>
                        </div>
      </div>
                <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Feb</span>
          <span class="day">4</span>
        </div>
<div class="bPost">
          <span class="title"><a href="http://www.eikke.com/articles">Articles</a></span>

                        <p>Converted my <a href="index.php/ikke/2005/01/31/gob_signals_walkthrough.html" title="first article">first article</a>, the one about <a href="http://developer.gnome.org/doc/API/2.0/gobject/gobject-Signals.html" title="GObject Signals">GObject Signals</a>, into the <a href="http://www.docbook.org/" title="Docbook">Docbook</a> format.<br />
The resulting HTML is <a href="http://www.eikke.com/articles/gob-signals.html" title="here">here</a>, the Docbook XML source <a href="http://www.eikke.com/articles/gob-signals.dbk" title="here">here</a>.<br />
The CSS stylesheet needs some more polishing, I know.<br />
Also try viewing the article in Yelp: download the source, and run "yelp gob-signals.dbk".<br />
I updated my <a href="http://www.eikke.com/" title="homepage">homepage</a> so there's a new link to the <a href="http://www.eikke.com/articles/" title="articles">articles</a> section now.</p>

<p>I'll convert the <a href="index.php/ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi.html" title="article on Makefiles">article on Makefiles</a> later, it's a tedious job.</p>

<p>Started working on the "Glib Mainloop" one, won't be finished too soon (not easy to know what to write about ;-))</p>                              <!-- End Post -->
                            <div class="bSmallPrint">
                        Ikke &bull; <a href="index.php/ikkeb5e7.html?cat=15" title="Browse category">Life</a>, <a href="index.php/ikke3f99.html?cat=16" title="Browse category">Technology</a>, <a href="index.php/ikkec055.html?cat=17" title="Browse category">Linux</a>, <strong><a href="index.php/ikke3cd0.html?cat=49" title="Browse category">Coding Corner</a></strong><a href="index.php/ikke/2005/02/04/articles.html" title="Permanent link to full entry" class="permalink_right"><img src="rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="index.php/ikke/2005/02/04/articles.html#comments" title="Display comments / Leave a comment">Leave a comment</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2005/02/04/articles"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2005/02/04/articles"
  dc:title="Articles"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/101" />
</rdf:RDF>-->
                </div>
</div>
                        </div>
      </div>
                <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Feb</span>
          <span class="day">3</span>
        </div>
<div class="bPost">
          <span class="title">Gnome 2.10.0 beta 1 released</span>

                        <p>Just got the notification on IRC. Jay, finally :-)</p>


<p>Musical hint: check out the "Cello Concerto in a" by Camille Saint-Sa</p>                              <!-- End Post -->
                            <div class="bSmallPrint">
                        Ikke &bull; <a href="index.php/ikkeb5e7.html?cat=15" title="Browse category">Life</a>, <strong><a href="index.php/ikke8e7f.html?cat=19" title="Browse category">Desktop</a></strong><a href="index.php/ikke/2005/02/03/gnome_2_10_0_beta_1_released.html" title="Permanent link to full entry" class="permalink_right"><img src="rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="index.php/ikke/2005/02/03/gnome_2_10_0_beta_1_released.html#comments" title="Display comments / Leave a comment">Leave a comment</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2005/02/03/gnome_2_10_0_beta_1_released"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2005/02/03/gnome_2_10_0_beta_1_released"
  dc:title="Gnome 2.10.0 beta 1 released"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/98" />
</rdf:RDF>-->
                </div>
</div>
                        </div>
      </div>
                <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Feb</span>
          <span class="day">1</span>
        </div>
<div class="bPost">
          <span class="title">Writing Makefiles the manual way, and using autotools</span>

                        <p>As promised, the article on writing Makefiles. As an extra, I also include how to build a basic/simple <a href="http://sources.redhat.com/autobook/autobook/autobook_toc.html" title="autotools">autotools</a> project.</p>

<h2>Writing Makefiles, the manual way</h2>
<p>Let's get started.<br />
First of all, you need all files used in my <a href="index.php/ikke/2005/01/31/gob_signals_walkthrough.html" title="previous article">previous article</a>, i.e. test-signal.gob and test-signal-test.c</p>

<p>There are some rules of thumb you can use when writing a Makefile manally:</p>
<ol>
<li>Find out what programs you need to process your source files</li><br />
<li>Find out what packages you need: which headers, and which libraries</li><br />
<li>Make a list of all source files, and find out which ones are dependent on others</li>
</ol>

<p>Let's get through these step by step:</p>
<ol>
<li>What programs do we need? We need <a href="http://www.5z.com/jirka/gob.html" title="gob2">gob2</a> of course, to process our gob file. Next to this, we need the stuff you need most of the time when creating a Makefile: a compiler and a linker. And guess what, <a href="http://gcc.gnu.org/" title="GCC">GCC</a> can do both things.</li><br />
<li>What packages do we need? Remember the command line thing you had to use when compiling the test-signal executable?<blockquote><p>gcc -Wall `pkg-config --libs --cflags gobject-2.0 glib-2.0` -o testsignal test-signal-test.c test-signal.c</p></blockquote>We don't even need this line to figure out what we need: we're building a <a href="http://developer.gnome.org/doc/API/2.0/gobject/" title="gobject">gobject</a>, so we need all libs and headers provided by the gobject package, version 2.x in our case, same thing for <a href="http://developer.gnome.org/doc/API/2.0/glib/" title="glib">glib</a>.<br />
How can we find out where these things are located? Well, the smart people at <a href="http://www.freedesktop.org/" title="freedesktop.org">freedesktop.org</a> made a nifty tool called <a href="http://www.freedesktop.org/Software/pkgconfig" title="pkg-config">pkg-config</a>. When a library is installed, it can install a pkg-config resource file, which lists the directories where it's stuff is installed. For some samples of these files, check /usr/lib/pkg-config. The pkg-config command line utility can parse these files and give you the information you need.</li><br />
<li>What source files have we got, and which one needs which? We got 2 files, test-signal.gob and test-signal-test.c. In the end we want to generate an executable called test-signal, which needs test-signal.c (the GObject implementation file) and test-signal-test.c.<br />
We will work in 2 stages here: first we'll compile all necessary .c files to an object file (.o), then in the end link all object files together in a nice executable.<br />
Here's what should happen: test-signal.gob should be parsed by gob to create our test-signal.c and test-signal.h file, test-signal.c must be compiled, test-signal-test.c must be compiled, and finaly test-signal.o and test-signal-test.o should be linked into test-signal.</li>
</ol>
<p>First a little intermezzo. You might be asking "If I need to make all these lists, what's the use? Can't I just write some <a href="http://www.gnu.org/software/bash/bash.html" title="Bash">Bash</a> script which executes the gcc command all at once?". Well, no. <a href="http://www.gnu.org/software/make/" title="Make">Make</a> does more than just executing some commands. It also checks whether it *should* do something. Imagine you got 100 source files. You got all of them compiled, linked into some executable, run that one, and find some bug. You fix it by editing some lines in one file, and re-execute your huge gcc command. Gcc would recompile all 100 files, which will take some time.<br />
If you use a Makefile make will find out only one file has been altered since the last build, it'll let gcc recompile only that file, then relink all object files together, which will take less time. Next to this: once using autotools, everything becomes much simpeler ;-)</p>

<p>Ok, now we got all prerequisites. Let's get started writing our Makefile.<br />
I always tend to use the same format when writing one (although I dont write many of them, I use autotools ;-)). I start with defining the executables:</p>
<blockquote><pre>GOB2=gob2
CC=gcc
LD=gcc</pre></blockquote><p>This is not necessary, but can be usefull sometimes. Now we can use these variables later on. If we want to change the linker, we only have to edit the Makefile in one place.</p>

<p>Next comes the definition of the CFLAGS, the flags given to the compiler (CC) when compiling a sourcefile into an object file:</p>
<blockquote><pre>CFLAGS=`pkg-config --cflags glib-2.0`
CFLAGS+=`pkg-config --cflags gobject-2.0`
CFLAGS+=-Wall -g</pre></blockquote>
<p>As you can see, we request the CFLAGS necessary for glib-2.0 and gobject-2.0 (2.x, actually) by querying pkg-config. In the end we add 2 compiler flags: -Wall, which tells gcc to show all possible warnings, and -g, which tells gcc to include debugging information. This can result in a somewhat bigger executable, but it is very usefull if we want to debug the program using <a href="http://www.gnu.org/software/gdb/" title="GDB">GDB</a>.</p>

<p>Now we define the LDFLAGS, the flags given to the linker:</p>
<blockquote><pre>LDFLAGS=`pkg-config --libs glib-2.0`
LDFLAGS+=`pkg-config --libs gobject-2.0`</pre></blockquote><p>This should be fairly self-explaining.</p>

<p>This project only consists of one executable, so I define an "OBJS" variable including all the object files needed to build our executable:</p>
<blockquote><pre>OBJS=test-signal.o test-signal-test.o</pre></blockquote>

<p>Now comes the name of the executable we want to create:</p>
<blockquote><pre>PROG=test-signal</pre></blockquote>

<p>Now the magic starts. Until now we only defined some variables for later use. We were not forced to do so, it's just more convenient later on. Actually, when building small things, we can just use re-use this Makefile, and only have to change the variable definitions (OBJS, PROG, maybe some CFLAGS and LDFLAGS).</p>

<p>Now some rules follow, which tell make how to handle files:</p>
<blockquote><pre>%.c %.h %-private.h: %.gob
        $(GOB2) $&lt;</pre></blockquote>
<p>This rule tells make: "When a foo.c, foo.h or foo-private.h is needed, and not existant, it should be made from foo.gob, by executing "$(GOB2) $&lt;" which gets expanded as "gob2 foo.gob"". Indeed, % represent "a string", $(GOB2) is the variable we defined at the beginning and gets expanded as "gob2", and $&lt; gets expanded as the first item on the right of the semicolon (":").<br />
One big thing to watch out for: Makefiles are indenting-sensitive <b>but</b> you may <b>not</b> use spaces. So in the last Makefile fragment there's a [tab] before $(GOB2).<br />
The format of a rule is very simple:</p>
<blockquote><pre>filenametobuild: dependenciestobuilditfrom
[tab]what to do first[enter]
[tab]what to do next if necessary[enter]</pre></blockquote><p>etc.</p>

<p>Next we define how to link our $(PROG):</p>
<blockquote><pre>$(PROG): $(OBJS)
        $(CC) $(LDFLAGS) $(OBJS) -o $(PROG)</pre></blockquote><p>$(PROG) is built out of $(OBJS) by issuing "$(CC) $(LDFLAGS) $(OBJS) -o $(PROG)", expanded to "gcc `pkg-config --libs gobject-2.0` `pkg-config --libs glib-2.0` test-signal.o test-signal-test.o -o test-signal"</p>

<p>We still have to tell make how to create object files out of source files:</p>
<blockquote><pre>%.o: %.c
        $(CC) $(CFLAGS) -c $&lt;</pre></blockquote>
<p>You should be able to figure out what this does by yourself.</p>

<p>Now we add some convenience targets:</p>
<blockquote><pre>all: $(PROG)

default: $(PROG)

clean:
        rm -f $(OBJS) $(PROG)
        rm -f test-signal.[ch]
        rm -f test-signal-private.h</pre></blockquote><p>This enables us to just type "make", which will start building the "default" target, or "make all", which will build the "all" target, or "make clean" to "build" the "clean" target.<br />
Notice a target </p><ol><li>is not forced to "do" something ("all" and "default"). You can just say "it depends on "foo" and/or "bar", which will be built then, and</li><br />
<li>the dependencies of a target <em>may</em> be empty ("clean")</li></ol>

<p>Let's end with the complete Makefile:</p>
<blockquote><pre>GOB2=gob2
CC=gcc
LD=gcc

CFLAGS=`pkg-config --cflags glib-2.0`
CFLAGS+=`pkg-config --cflags gobject-2.0`
CFLAGS+=-Wall -g

LDFLAGS=`pkg-config --libs glib-2.0`
LDFLAGS+=`pkg-config --libs gobject-2.0`

OBJS=test-signal.o test-signal-test.o

PROG=test-signal

%.c %.h %-private.h: %.gob
        $(GOB2) $&lt;

$(PROG): $(OBJS)
        $(CC) $(LDFLAGS) $(OBJS) -o $(PROG)

%.o: %.c
        $(CC) $(CFLAGS) -c $&lt;

all: $(PROG)

default: $(PROG)

clean:
        rm -f $(OBJS) $(PROG)
        rm -f test-signal.[ch]
        rm -f test-signal-private.h
</pre></blockquote>
<p>Save this file as a file called "Makefile" in your source directory, and type "make". This should be the result:</p>
<blockquote><p>gob2 test-signal.gob<br />
gcc `pkg-config --cflags glib-2.0` `pkg-config --cflags gobject-2.0` -Wall -g -c test-signal.c<br />
test-signal.c: In function `test_signal_testsignal':<br />
test-signal.c:141: warning: implicit declaration of function `memset'<br />
gcc `pkg-config --cflags glib-2.0` `pkg-config --cflags gobject-2.0` -Wall -g -c test-signal-test.c<br />
gcc `pkg-config --libs glib-2.0` `pkg-config --libs gobject-2.0` test-signal.o test-signal-test.o -o test-signal<br />
rm test-signal.c</p>
</blockquote><p>Notice the "rm test-signal.c": make removes the files it generated itself, so when you update test-signal.gob, it will tell gob to reconstruct the c file, otherwise the c file wouldnt get updated.</p>

<p>Now you should be able to execute ./test-signal.</p>

<p>Ok, we got a nice Makefile now, but it took some time to write it, isn't it? And we don't have a "normal" FOSS install method like ./configure, make, make install...</p>

<p>Well, that's what we are going to do now. The following stuff is much easier than writing Makefiles by hand (you know, FOSS devs <em>are</em> lazy people ;-)), but it is useful to know how Makefiles are formatted, and how they work, though.</p>

<p>Ok, time for some really 1337 (couldn't stop it) stuff: introducing <a href="http://www.gnu.org/" title="GNU">GNU</a> Autotools.</p>

<h2>Using the GNU Autotools to build your project</h2>
<p>Didn't you ever want to be able to write such a neat ./configure script yourself? Here's how to do it with our sample project :-)</p>

<p>Autotools consist of a bunch of utilities, most of them starting with "auto" (duh). There's <a href="http://www.gnu.org/software/autoconf/" title="autoconf">autoconf</a> to generate a "configure" script from a file you provide, there's the <a href="http://www.gnu.org/software/automake/" title="automake">automake</a> script that creates Makefile's for you (actually, it does not create Makefiles. Read on), and many more.</p>

<p>This is how it works: the configure script will look up a bunch of stuff for you (or you provide it using --with-foo=... etc), it will do some tests to figure out whether the project should compile and run cleanly on your system, and in the end it will generate some files.<br />
A boilerplate for these generated files should be provided by you, called "thefile.in". The generated file will be "thefile" then. Inside "thefile.in", you can use variables like these: "@FOO@", which will be substituted by the configure script.<br />
That's the system automake uses: you write a simple Makefile.am file (read on on how to do this), automake generates a long and difficult Makefile.in file, which gets processed by configure to create the final Makefile.</p>

<p>GNU Autotools have some strict rules (although it is possible, but not advisable, to get around them). Source files should be in the src/ subdirectory, and some files are required in the root directory of the project. We'll find out which ones these are later on.</p>

<p>Let's get started by creating our initial project directory layout:</p>
<blockquote><p>#Go into an empty directory<br />
mkdir src<br />
cd src<br />
cp /foo/bar/test-signal.gob ./<br />
cp /foo/bar/test-signal-test.c ./<br />
cd ..</p></blockquote>

<p>Initial task: once more, figure out what the required dependencies are. As mentioned in the first part, we need gobject-2.0 and glib-2.0. Next to this, we need a working C compiler.</p>

<p>We can start writing a configure.in file now, in the root dir of our project, which will be processed by autoconf to generate out ./configure script. Here's what it could look like, comments (starting with "dnl") inline:</p>
<blockquote><pre>dnl Register ourselves to autoconf, giving the main source file
AC_INIT(src/test-signal-test.c)

dnl Init Automake, giving the program name and version. More parameters (author and author's email) are optional
AM_INIT_AUTOMAKE(TestSignal, 0.1)
dnl Enable maintainer mode (debugging flags etc)
AM_MAINTAINER_MODE

dnl Check whether we got a good C compiler. Variable "CC" will be defined and expanded in the .in files
AC_PROG_CC

dnl GOB2 macro, to check whether gob version >=x.y.z (here >=2.0.0) is found. Variable "GOB2" will be substituted/expanded
GOB2_CHECK([2.0.0])

dnl Use built-in macro's to query pkg-config. First parameter is a variable name we'll use later on, second is the package to check for (with optional minimal version), third is the thing to do if the package is found, fourth if not
PKG_CHECK_MODULES(GLIB, glib-2.0, have_glib=true, have_glib=false)
if test "x${have_glib}" = "xfalse" ; then
        AC_MSG_ERROR([No Glib package information found])
fi
dnl So glib-2.0 is found. Remember the first parameter in the previous command, GLIB? Well, GLIB_CFLAGS now contains the output of `pkg-config --cflags glib-2.0`, same thing for GLIB_LIBS with --libs instead of --cflags
dnl AC_SUBST tells configure to substitute the given value in the provided .in files
AC_SUBST(GLIB_CFLAGS)
AC_SUBST(GLIB_LIBS)

dnl Same thing for gobject-2.0
PKG_CHECK_MODULES(GOBJECT, gobject-2.0, have_gobject=true, have_gobject=false)
if test "x${have_gobject}" = "xfalse" ; then
        AC_MSG_ERROR([No GObject package information found])
fi
AC_SUBST(GOBJECT_CFLAGS)
AC_SUBST(GOBJECT_LIBS)

dnl Here we tell the configure script which files to *create*, so we leave out the .in part
AC_OUTPUT([
        Makefile        \
        src/Makefile
])
</pre></blockquote><p>Currently Makefile.in and src/Makefile.in don't exist yet, they will be created by automake later on.</p>

<p>This file is a very simple one, it can be a tedious job to create <a href="http://cvs.sourceforge.net/viewcvs.py/ivman/ivman/configure.in?rev=1.12&amp;view=auto" title="complex configure.in files">complex configure.in files</a> :-/</p>

<p>Next thing: Makefile.am files, which will be processed by automake to create the Makefile.in's.<br />
In the project root dir, this file can be very simple:</p><blockquote><pre>SUBDIRS = src</pre></blockquote><p>We just define the subdir(s) of the current dir.<br />
src/Makefile.am is a little more complex:</p>
<blockquote><pre>INCLUDES = $(GLIB_CFLAGS) $(GOBJECT_CFLAGS)

bin_PROGRAMS = test-signal

test_signal_SOURCES = test-signal.c test-signal-test.c

test_signal_LDADD = $(GLIB_LIBS) $(GOBJECT_LIBS)

%.c %.h %-private.h: %.gob
        @GOB2@ $&lt;</pre></blockquote><p>Some explanation:</p>
<ul><li>"INCLUDES" is a variable that will be given to every compile call to "$(CC)", here we only need the glib and gobject includes. Remember these values will be setted by the configure script.</li>
<li>"bin_PROGRAMS" is a variable defining the names of all targets we want to be installed as an executable in the bin directory (/usr/local/bin if no prefix is given to ./configure)</li>
<li>"test_signal_SOURCES" is a variable defining which files are needed to make the target "test-signal". Notice "-" being replaced with "_" here, which is a common thing in automake files.</li>
<li>"test_signal_LDADD" defines which parameters to offer to the linker when linking the input object files to the "test-signal" executable. We could have used a global "LDADD" variable here, like "INCLUDES", or have made "INCLUDES" non-global by using "test_signal_INCLUDES". In large projects this can make a big difference.</li>
<li>The last part is the one we also used in our hand-written Makefile. It will be put like this in the resulting Makefile.in by automake, so make will know how to build .c and .h files from a .gob file.<br />
Automake puts all non-automake-specific stuff that's in Makefile.am in the resulting Makefile.in.</li></ul>

<p>Now everything is done. At least, almost ;-) We still need to call out autotool scripts.<br />
It's easy to do this from a shell script. Most projects call this script "autogen.sh", so will we. This script can be <a href="http://cvs.sourceforge.net/viewcvs.py/ivman/ivman/autogen.sh?view=markup" title="fairly complex">fairly complex</a>, ours will be braindead easy:</p>
<blockquote><pre>#!/bin/bash
aclocal
autoconf
automake -a
</pre></blockquote><p>As you can see, we first call aclocal (part of the automake package), then autoconf, then automake with the -a flag.<br />
Why "aclocal"? Autoconf, which creates a configure script out of a configure.in file, uses M4, a complex macro system, to do this. aclocal copies the necessary macro definitions for your system to the right place.</p>

<p>Run this script, or enter the commands by hand. aclocal can give a lot of warnings, don't bother about these.<br />
If this is the first time you run the script, you will see some automake errors in the end, and the script execution will fail:</p>
<blockquote><p>Makefile.am: required file `./NEWS' not found<br />
Makefile.am: required file `./README' not found<br />
Makefile.am: required file `./AUTHORS' not found<br />
Makefile.am: required file `./ChangeLog' not found</p>
</blockquote><p>These are the required files I mentioned earlier. We'll just touch them for now so they "exist", although contain no usefull information:</p>
<blockquote><p>touch NEWS README AUTHORS ChangeLog</p></blockquote>
<p>Now restart the autogen.sh script, everything should pass now.</p>

<p>If you take a look now, you'll see a couple of Makefile.in files are created now (who will be converted into Makefiles by configure, remember?), and the configure script.</p>

<p>Let's take our work to the test, and run ./configure. You'll see the usual output, and everything should pass fine (we don't have a lot of prerequisites :-))</p>

<p>Now let's try if our project builds fine:</p>
<blockquote><p>make</p></blockquote>

<p>Jay, lot of compiler commands, no errors. Fun :-)</p>

<p>To finish, test whether the executable works:</p>
<blockquote><pre>cd src
./test-signal</pre></blockquote><p>The same output as before appears, we're member of the Autotools User Group now ;-)</p>

<p>That's it for now, more stuff should follow: "The Glib mainloop", "Debugging using GDB", and a from-scratch "program" we'll create. I only lack the time to write everything ;-)</p>

<p>I'd like to convert these articles to some format so they can be used outside this blog (converted to PDF, HTML,...). <a href="http://www.docbook.org/" title="Docbook">Docbook</a> seems to be a good format to do this, I need to get used to it first, though. If someone knows a good Docbook editor (next to <a href="http://www.conglomerate.org/" title="Conglomerate">Conglomerate</a>), please let me know.</p>                              <!-- End Post -->
                            <div class="bSmallPrint">
                        Ikke &bull; <a href="index.php/ikke3f99.html?cat=16" title="Browse category">Technology</a>, <a href="index.php/ikkec055.html?cat=17" title="Browse category">Linux</a>, <strong><a href="index.php/ikke3cd0.html?cat=49" title="Browse category">Coding Corner</a></strong><a href="index.php/ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi.html" title="Permanent link to full entry" class="permalink_right"><img src="rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="index.php/ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi.html#comments" title="Display comments / Leave a comment">1 comment</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2005/02/01/writing_makefiles_the_manual_way_and_usi"
  dc:title="Writing Makefiles the manual way, and using autotools"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/95" />
</rdf:RDF>-->
                </div>
</div>
                        </div>
      </div>
                <div class="bPost bPostpublished" lang="en-US">
                      <!-- Start Post -->
      <div class="post">

        <div class="date">
          <span class="month">Feb</span>
          <span class="day">1</span>
        </div>
<div class="bPost">
          <span class="title"><a href="http://ccux-linux.de/site/modules.php?op=modload&amp;name=News&amp;file=article&amp;sid=31">I'm amazed</a></span>

                        <p>I just found <a href="http://distrowatch.com/?newsid=02313#0" title="this article">this article</a> on <a href="http://www.distrowatch.com/" title="distrowatch.com">distrowatch.com</a>, and I'm amazed. This is *so* unreal :crazy:<br />
If you're too lazy to read it, or just want to know why you should: it looks like <a href="http://ccux-linux.de/" title="CCux Linux">CCux Linux</a> included <a href="http://ivman.sf.net/" title="Ivman">Ivman</a> in their latest development release, by default XX(<br />
Quoting the <a href="http://ccux-linux.de/site/modules.php?op=modload&amp;name=News&amp;file=article&amp;sid=31" title="Release Notes">Release Notes</a>:</p><blockquote><p>(But) This Version has some nice new Features too. Supermount doesn't handle the automatically Device mounting. In Fact, this is now handled from dbus 0.23, hal 0.4.7 and <b>ivman 0.5</b>. This Combination does this Job <b>much better</b> when mounting CD/DVD Drives or USB Sticks, Kameras or other Things. Therefore <b>it doesn't need anymore User Interaction</b> to <b>get all Drives running</b>.</p></blockquote>
<p>88| :-P :-) :-D :-p B-) |-| :>></p>

<p>This is some great new, isn't it? Mostly thanks to <a href="http://mizzenblog.com/" title="Rohan">Rohan</a> lately I guess :-) YOU ROCK</p>

<p>Next to this: as promised in my GObject Signal handling article, I wrote a makefile for it, and even did the autotools stuff. I'll write an article on that stuff this evening, or tomorrow, if possible.</p>

<p>PS. Good news: exam was fairly good, I think. Let's hope for the best tomorrow.</p>                              <!-- End Post -->
                            <div class="bSmallPrint">
                        Ikke &bull; <a href="index.php/ikke3f99.html?cat=16" title="Browse category">Technology</a>, <strong><a href="index.php/ikke7f33.html?cat=31" title="Browse category">Ivman</a></strong><a href="index.php/ikke/2005/02/01/i_m_amazed.html" title="Permanent link to full entry" class="permalink_right"><img src="rsc/icons/minipost.gif" border="0" align="top" width="12" height="9"  class="middle" alt="Permalink"/></a>
                        <a href="index.php/ikke/2005/02/01/i_m_amazed.html#comments" title="Display comments / Leave a comment">4 comments</a>                                                                        
                        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" 
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
  rdf:about="http://blog.eikke.com/index.php/ikke/2005/02/01/i_m_amazed"
  dc:identifier="http://blog.eikke.com/index.php/ikke/2005/02/01/i_m_amazed"
  dc:title="I&#039;m amazed"
  trackback:ping="http://blog.eikke.com/htsrv/trackback.php/94" />
</rdf:RDF>-->
                </div>
</div>
                        </div>
      </div>
        
        <p class="center"><strong>
                <a href="indexf09d-2.html?blog=5&amp;page=1&amp;paged=33">&lt;&lt; Previous Page</a> :: <a href="index0799-2.html?blog=5&amp;page=1&amp;paged=35">Next Page &gt;&gt;</a>                 </strong></p>

    </div>
    <!-- Left column end -->


    <!-- Right link column -->
    <div class="floatRight width25 lightBlueBg horzPad">
               <div class="bSideItem">
                <form action="http://blog.eikke.com/index.php/ikke" method="get" name="SearchForm" class="search">                        <p><input type="text" name="s" size="23" value="" class="SearchField" /><br />
                        <input type="submit" name="submit" class="submit" value="Search" style="margin-top:3px" /></p>
                </form>
        </div>
		<div class="bSideItem">
	<div style='position: relative; left: 25px;'>
	<script type="text/javascript"><!--
	google_ad_client = "pub-7170970013053423";
	//Ikke&#39;s blog
	google_ad_slot = "5340725895";
	google_ad_width = 120;
	google_ad_height = 240;
	//--></script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script></div>
		</div>
              <div class="catarc"><h3>Categories</h3><ul><li><a href="index.php/ikke.html">All</a></li>
<li><a href="index.php/ikkeb5e7.html?cat=15">Life</a> <span class="notes">(56)</span></li>
<li><a href="index.php/ikke3f99.html?cat=16">Technology</a> <span class="notes">(131)</span><ul><li><a href="index.php/ikke3cd0.html?cat=49">Coding Corner</a> <span class="notes">(64)</span><ul><li><a href="index.php/ikkebff0.html?cat=52">Docbook</a> <span class="notes">(7)</span></li>
<li><a href="index.php/ikkee864.html?cat=63">Summer of Code 06</a> <span class="notes">(0)</span></li>
</ul>
</li>
<li><a href="index.php/ikke8e7f.html?cat=19">Desktop</a> <span class="notes">(93)</span></li>
<li><a href="index.php/ikke7f33.html?cat=31">Ivman</a> <span class="notes">(3)</span></li>
<li><a href="index.php/ikkec055.html?cat=17">Linux</a> <span class="notes">(90)</span></li>
<li><a href="index.php/ikke6c5d.html?cat=18">Networks</a> <span class="notes">(14)</span></li>
</ul>
</li>
</ul>
</div>

        <div class="catarc"><h3>Archives</h3><ul><li><a href="index.php/ikke/2007/12/index.html">December 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="index.php/ikke/2007/11/index.html">November 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="index.php/ikke/2007/10/index.html">October 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="index.php/ikke/2007/09/index.html">September 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="index.php/ikke/2007/08/index.html">August 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="index.php/ikke/2007/05/index.html">May  2007</a> <span class="dimmed">(2)</span></li>
<li><a href="index.php/ikke/2007/04/index.html">April 2007</a> <span class="dimmed">(4)</span></li>
<li><a href="index.php/ikke/2007/03/index.html">March 2007</a> <span class="dimmed">(5)</span></li>
<li><a href="index.php/ikke/2007/02/index.html">February 2007</a> <span class="dimmed">(2)</span></li>
<li><a href="index.php/ikke/2007/01/index.html">January 2007</a> <span class="dimmed">(3)</span></li>
<li><a href="index.php/ikke/2006/07/index.html">July 2006</a> <span class="dimmed">(1)</span></li>
<li><a href="index.php/ikke/2006/06/index.html">June 2006</a> <span class="dimmed">(3)</span></li>
<li><a href="index.php/ikke1579.html?disp=arcdir">More...</a></li>
</ul>
</div>


	                <div class="catarc">
                <h3 class="sideItemTitle">Who's Online?</h3>
                <ul class="onlineUsers"><li>Guest Users: 489</li></ul>        </div>
        
        <div class="bSideItem">
                <h3>Misc</h3>
                <ul>
                        <li><a href="htsrv/login9dca.html?redirect_to=http%3A%2F%2Fblog.eikke.com%2Findex.php%3Fblog%3D5%26amp%3Bpaged%3D34%26amp%3Bpage%3D1" title="Login if you have an account...">Login...</a></li>                </ul>
        </div>
        <div class="bSideItem">
                <h3><img src="rsc/icons/feed-icon-16x16.gif" width="16" height="16" class="top" alt="" /> XML Feeds</h3>
                        <ul>
                                <li>
                                        RSS 0.92:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="index.php/ikke7f88.html?tempskin=_rss&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        RSS 1.0:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="index.php/ikke374e.html?tempskin=_rdf&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        RSS 2.0:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="index.php/ikke6fea.html?tempskin=_rss2&amp;disp=comments">Comments</a>
                                </li>
                                <li>
                                        Atom:
                                        <a href="http://eikke.com/feed/">Posts</a>
                                        <a href="index.php/ikke5609.html?tempskin=_atom&amp;disp=comments">Comments</a>
                                </li>
                        </ul>
                        <a href="http://fplanque.net/Blog/itTrends/2004/01/10/rss_rdf_and_atom_in_a_nutshell" title="External - English">What is RSS?</a>
			<div class='bSideItem'><div style='width: 120px; height: 600px; position: relative; left: 25px; padding-bottom: 10px;'>
			<script type="text/javascript"><!--
			google_ad_client = "pub-7170970013053423";
			//blog.eikke.com sidebar onderaan
			google_ad_slot = "7138271274";
			google_ad_width = 120;
			google_ad_height = 600;
			//--></script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
			</div></div>        </div>


        


    </div>
    <!-- Right links column end -->



    </div>
    <!-- #columns end -->

  </div>
  <!-- #page end -->

</div>
<!-- #content end -->




<!-- #footer: holds the site footer (logo and links) -->
<div id="footer">

  <!-- #bg: applies the site width and footer background -->
  <div id="bg" class="width">

    <img src="skins/nautica05-2col/images/logo.gif" alt="Your logo goes here"/>

    <ul>
      <li><a href="http://b2evolution.net/" title="Powered by b2evolution">b<sub>2</sub>evolution</a></li>
      <li><a href="http://www.brendoman.com/dbc" title="Evoskin by Danny Ferguson">Danny Ferguson</a></li>
      <li><a href="http://www.studio7designs.com/" title="Design by Studio 7 Designs" class="last">studio7designs.com</a></li>
	</ul>

  </div>
  <!-- #bg end -->

</div>
<!-- #footer end -->
</body>


<!-- Mirrored from blog.eikke.com/index.php?blog=5&page=1&paged=34 by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 20:04:20 GMT -->
</html>
